function getRandomStone(){var t=Math.random()
return.333>t?"redstone":.666>t?"greenstone":"bluestone"}function over(t){click.play(),this.tween=this.add.tween(t.scale).to({x:4.5,y:2.5},300,"Linear",!0)}function out(t){this.tweens=this.add.tween(t.scale).to({x:4,y:2},300,"Linear",!0)}var MyGame={}
MyGame.Boot=function(t){},MyGame.Boot.prototype={init:function(){this.stage.backgroundColor="#000000",this.game.device.desktop?(this.scale.pageAlignVertically=!0,this.scale.pageAlignHorizontally=!0):(this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.setMinMax(400,300,800,600),this.scale.forceLandscape=!0,this.scale.pageAlignHorizontally=!0)},preload:function(){this.game.load.image("loading","assets/loading.png")},create:function(){this.state.start("preloader")}},Enemy=function(t,e,i,s,a,h,o,r,n){this.game=i,this.jumpTimer=0,this.jumpTime=500,this.jumpHeight=300,this.speed=s,this.domage=r,this.chance=h,this.nbrR=Math.floor(o*Math.random())+1,this.hp=a,this.sm=n,Phaser.Sprite.call(this,i,t,e,"enemy"),i.physics.enable(this,Phaser.Physics.ARCADE),this.body.velocity.x=-s,this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.animations.add("left",[6,7,6,8],5,!0),this.animations.play("left"),this.anchor.set(.5),this.timerDomage=0},Enemy.prototype=Object.create(Phaser.Sprite.prototype),Enemy.prototype.action=function(t,e,i){t.now-this.jumpTimer>=this.jumpTime&&this.jump(t),this.hp<=0&&(this.createResource(e),this.destroy())},Enemy.prototype.createResource=function(){Math.random()<this.chance&&powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),!0,this.nbrR)),Math.random()<.05&&powerups.add(new Powerups(this.x,this.y,this.game,"heart",!0,1))},Enemy.prototype.hurt=function(t,e){3!==e&&this.sm.enemyhurt.play(),this.hp-=t},Enemy.prototype.jump=function(t){Math.random()>.2&&this.body.touching.down&&(this.body.velocity.y=-this.jumpHeight*(Math.random()+1)),this.jumpTimer=t.now},Enemy.prototype.slowDown=function(){this.sm.ennemibouffecore.isPlaying||this.sm.ennemibouffecore.play(),this.body.velocity.x=-10,this.body.gravity.y=0,this.body.velocity.y=0},MyGame.Game=function(t){this.game,this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.state,this.world,this.particles,this.physics,this.rnd},MyGame.Game.prototype={create:function(){music=this.add.audio("level"),this.game.state.states.menu.playMusic&&music.play("",0,1,!0),sm=new SoundManager(this.game),this.game.physics.startSystem(Phaser.Physics.ARCADE),enemies=this.game.add.group(),player=new Player(200,1e3,this.game,sm),this.game.add.existing(player),stage=new Stage(this.game,player,enemies,sm),stage.createPlatforms(),gui=new GUI(this.game,stage,player,sm),powerups=this.game.add.group(),player.turrets=this.game.add.group(),player.turrets.enableBody=!0,player.turrets.physicsBodyType=Phaser.Physics.ARCADE,player.bullets=this.game.add.group(),player.bullets.enableBody=!0,player.bringToTop(),this.game.world.bringToTop(enemies),this.grass=this.game.add.sprite(0,1140,"grass"),player.flash=this.game.add.sprite(this.x,this.y-20,"flash"),player.flash.visible=!1,player.flash.anchor.set(.5)},update:function(){player.action(stage.platforms,enemies,powerups),stage.action(this.time,player,enemies,player.turrets,gui,powerups),gui.action()
for(var t in enemies.children)enemies.children[t].body.x<30&&stage.gameOver===!1&&(stage.gameOver=!0,gui.endGame(stage.waveCount)),enemies.children[t].action(this.time,powerups,stage,player)
for(var t in powerups.children)powerups.children[t].action()}},GUI=function(t,e,i,s){this.game=t,this.player=i,this.stage=e,this.numberHeart=10,achat=5,this.sm=s,style={font:"40px Arial",fill:"#000000",align:"left"},resourcesStyle={font:"20px Arial",fill:"#000000",align:"left"},this.redstone=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle),this.bluestone=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle),this.greenstone=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle),this.turretsCapacity=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle),this.hearts=this.game.add.group()
for(var a=this.numberHeart-1;a>=0;a--)h=this.hearts.create(35*a+15,34,"heart"),h.scale.setTo(.3,.3)
this.hearts.setAll("fixedToCamera",!0),this.redstone.fixedToCamera=!0,this.redstone.cameraOffset.setTo(960,45),this.bluestone.fixedToCamera=!0,this.bluestone.cameraOffset.setTo(960,85),this.greenstone.fixedToCamera=!0,this.greenstone.cameraOffset.setTo(960,130),this.turretsCapacity.fixedToCamera=!0,this.turretsCapacity.cameraOffset.setTo(800,45),this.turret=this.game.add.sprite(770,35,"turret"),this.turret.scale.setTo(.1,.1),this.turret.fixedToCamera=!0,this.stones=this.game.add.group(),r=this.stones.create(900,30,"redstone"),r.scale.setTo(.5,.5),b=this.stones.create(900,70,"bluestone"),b.scale.setTo(.5,.5),g=this.stones.create(900,120,"greenstone"),g.scale.setTo(.5,.5),this.stones.setAll("fixedToCamera",!0),this.game.add.text(90,120,"R : RESET",resourcesStyle),this.game.add.text(345,120,"F : FUSION",resourcesStyle)
var o=4
this.positionMilieu=90*o/2-135,this.game.add.text(this.positionMilieu+90+42,300,"MACHINE Ã€ FUSION",resourcesStyle),this.graphics=this.game.add.graphics(90,150),this.elementFusion=this.game.add.group(),this.elementFusion.enableBody=!0
var n=["redstone","bluestone","greenstone","player"]
this.createMachine(o,n),this.positionDrag=new Phaser.Point,this.tabFusion=[]
var l=this.game.input.keyboard.addKey(Phaser.Keyboard.R)
l.onDown.add(this.initItemFusion,this)
var d=this.game.input.keyboard.addKey(Phaser.Keyboard.F)
d.onDown.add(this.fusion,this)
var u=90*o+40
this.legend(u)},GUI.prototype.setDisplayStone=function(){this.redstone.text="X "+this.player.numberStoneRed,this.bluestone.text="X "+this.player.numberStoneBlue,this.greenstone.text="X "+this.player.numberStoneGreen},GUI.prototype.setDisplayHealth=function(){var t=this.numberHeart-Math.ceil(this.player.health)
if(!(0===t||this.player.health>10))if(0>t)for(;0!==t;){var e=this.hearts.getAt(9-this.numberHeart)
if(null==e)break
e.alive=!0,e.visible=!0,t++,this.numberHeart++}else for(;0!==t;){var e=this.hearts.getFirstAlive()
if(null==e)break
e.alive=!1,e.visible=!1,t--,this.numberHeart--}},GUI.prototype.setDisplayTurrets=function(){this.turretsCapacity.text=this.player.nbrTurrets+" / "+this.player.maxTurrets},GUI.prototype.action=function(){this.setDisplayStone(),this.setDisplayHealth(),this.setDisplayTurrets()},GUI.prototype.displayWave=function(t){waveInfos=this.game.add.text(this.game.camera.x,this.game.camera.y,"WAVE "+t,style),waveInfos.fixedToCamera=!0,waveInfos.cameraOffset.setTo(450,300),waveInfos.alpha=0
var e=this.game.add.tween(waveInfos).to({alpha:1},2e3,"Linear",!0,0,-1).repeat(0)
e.yoyo(!0,3e3),this.sm.gong.play()},GUI.prototype.endGame=function(t){this.sm.vousetesunechec.play(),this.player.kill(),reset=this.game.add.button(530,400,"reset-button",this.back,this,2,1,0,2),reset.scale.setTo(2,2),reset.anchor.setTo(.5,.5),reset.fixedToCamera=!0,end=this.game.add.sprite(350,70,"gameover"),end.fixedToCamera=!0,end.alpha=0,tween=this.game.add.tween(end).to({alpha:1},1e3,"Linear",!0,0,-1).repeat(0),endInfo=this.game.add.text(this.game.camera.x+100,this.game.camera.y+65,"Wave: "+t,style),endInfo.anchor.set(.5)},GUI.prototype.legend=function(t){var e={font:"18px Arial",fill:"#000000",align:"left"}
this.graphics.beginFill(12303291,1),this.graphics.drawRect(t-10,-120,410,565),this.graphics.endFill(),this.game.add.text(t+45+200,35,"LEGENDE",e)
var i=this.game.add.text(t+45+42,205,"TURRET",e)
i.angle=-90,this.graphics.lineStyle(2,15887439,1),this.graphics.moveTo(t+7,-20),this.graphics.lineTo(t+7,-90),this.graphics.lineTo(t+100,-90),this.graphics.lineStyle(2,15887439,1),this.graphics.moveTo(t+7,60),this.graphics.lineTo(t+7,130),this.graphics.lineTo(t+100,130)
var i=this.game.add.text(t+45+42,500,"PERSONNAGE",e)
i.angle=-90,this.graphics.lineStyle(2,15887439,1),this.graphics.moveTo(t+7,220),this.graphics.lineTo(t+7,140),this.graphics.lineTo(t+100,140),this.graphics.lineStyle(2,15887439,1),this.graphics.moveTo(t+7,355),this.graphics.lineTo(t+7,435),this.graphics.lineTo(t+100,435)
for(var s=75,a={font:"10px Arial",fill:"#000000",align:"left"},h=[["redstone","bluestone","MUR"],["greenstone","redstone","CERCLE"],["bluestone","greenstone","INVINCIBLE"],["player","redstone","FORCE"],["player","bluestone","DEFENCE"],["player","greenstone","VITESSE"],["redstone","bluestone","greenstone","TURRET"]],o=0;7>o;o++){var r=0
o>=3&&(r=10),this.game.add.text(t+90+85,80+r+s*o,"+",resourcesStyle),6>o?(this.game.add.text(t+180+85,88+r+s*o,"=",resourcesStyle),this.game.add.text(t+180+85+25,88+r+s*o,h[o][2],resourcesStyle)):(this.game.add.text(t+180+85,80+r+s*o,"+",resourcesStyle),this.game.add.text(t+270+85,88+r+s*o,"=",resourcesStyle),this.game.add.text(t+270+85+25,88+r+s*o,h[o][3],resourcesStyle)),"player"==h[o][0]?this.game.add.text(t+90+40,60+r+s*o,"X1",a):this.game.add.text(t+90+35,65+r+s*o,"X"+achat,a),this.game.add.text(t+180+35,65+r+s*o,"X"+achat,a),this.graphics.lineStyle(2,15887439,1),this.graphics.moveTo(t+90-10,-45+r+s*o),this.graphics.lineTo(t+90+10,-45+r+s*o),this.graphics.lineTo(t+90+5,-50+r+s*o),this.graphics.moveTo(t+90+10,-40+r+s*o),this.graphics.lineTo(t+90-10,-40+r+s*o),this.graphics.lineTo(t+90-5,-35+r+s*o)
var n=this.game.add.sprite(t+90+45,100+r+s*o,h[o][0])
n.anchor.set(.5),n.scale.setTo(.5,.5)
var n=this.game.add.sprite(t+180+45,100+r+s*o,h[o][1])
if(n.anchor.set(.5),n.scale.setTo(.5,.5),6===o){var n=this.game.add.sprite(t+270+45,100+r+s*o,h[o][2])
n.anchor.set(.5),n.scale.setTo(.5,.5),this.graphics.moveTo(t+180-10,-45+r+s*o),this.graphics.lineTo(t+180+10,-45+r+s*o),this.graphics.lineTo(t+180+5,-50+r+s*o),this.graphics.moveTo(t+180+10,-40+r+s*o),this.graphics.lineTo(t+180-10,-40+r+s*o),this.graphics.lineTo(t+180-5,-35+r+s*o),this.game.add.text(t+270+35,65+r+s*o,"X"+achat,a)}}},GUI.prototype.createMachine=function(t,e){this.graphics.lineStyle(5,6710886,1),this.graphics.beginFill(12303291,.7)
for(var i=0;t>i;i++){this.graphics.drawRect(90*i,0,90,90)
var s=this.game.add.sprite(90*i+135,195,e[i])
s.anchor.set(.5),s.scale.setTo(.8,.8),s.inputEnabled=!0,s.input.enableDrag(),s.events.onDragStart.add(this.dragStart,this),s.events.onDragStop.add(this.dragStop,this),this.elementFusion.add(s)}this.graphics.endFill(),this.graphics.lineStyle(5,6710886,1),this.graphics.beginFill(6710886,1)
var a=90*t/2
this.graphics.moveTo(a,100),this.graphics.lineTo(a,130),this.graphics.lineTo(a-5,130),this.graphics.lineTo(a,135),this.graphics.lineTo(a+5,130),this.graphics.lineTo(a,130),this.graphics.endFill(),this.graphics.lineStyle(5,6710886,1),this.graphics.beginFill(12303291,.7)
for(var i=0;3>i;i++)this.graphics.drawRect(this.positionMilieu+90*i,180,90,90)
this.graphics.endFill()},GUI.prototype.initItemFusion=function(){for(var t in this.elementFusion.children)this.elementFusion.children[t].x=90*t+135,this.elementFusion.children[t].y=195,this.elementFusion.children[t].inputEnabled=!0
this.tabFusion=[]},GUI.prototype.dragStart=function(t){this.positionDrag.x=t.position.x,this.positionDrag.y=t.position.y},GUI.prototype.dragStop=function(t){if(t.y<=240||this.tabFusion.length>=3)t.x=this.positionDrag.x,t.y=this.positionDrag.y
else{var e=this.tabFusion.length
t.x=this.positionMilieu+90*e+135,t.y=375,t.inputEnabled=!1,this.tabFusion.push(t)}},GUI.prototype.fusion=function(t){if(!(this.tabFusion.length<=1)){var e=[]
for(var i in this.elementFusion.children)this.elementFusion.children[i].inputEnabled?e[i]=!1:e[i]=!0
var s=!1
3===this.tabFusion.length?e[0]&&e[1]&&e[2]&&this.player.numberStoneBlue>=achat&&this.player.numberStoneRed>=achat&&this.player.numberStoneGreen>=achat&&this.player.maxTurrets<30&&(this.player.numberStoneBlue-=achat,this.player.numberStoneRed-=achat,this.player.numberStoneGreen-=achat,this.player.maxTurrets+=5,s=!0,this.sm.capaciteaugmente.play()):(e[0]&&e[1]&&this.player.numberStoneBlue>=achat&&this.player.numberStoneRed>=achat&&(this.player.numberStoneBlue-=achat,this.player.numberStoneRed-=achat,this.player.bonus2=!0,this.player.flash.visible=!0,s=!0,this.sm.murdeboules.play()),e[0]&&e[2]&&this.player.numberStoneGreen>=achat&&this.player.numberStoneRed>=achat&&(this.player.numberStoneGreen-=achat,this.player.numberStoneRed-=achat,this.player.bonus1=!0,s=!0,this.player.flash.visible=!0,this.sm.rayonbrutal.play()),e[1]&&e[2]&&this.player.numberStoneGreen>=achat&&this.player.numberStoneBlue>=achat&&(this.player.numberStoneGreen-=achat,this.player.numberStoneBlue-=achat,this.player.bonus3=!0,s=!0,this.player.flash.visible=!0,this.sm.immunitedivine.play()),e[3]&&e[0]&&this.player.numberStoneRed>=achat&&(this.player.numberStoneRed-=achat,this.player.domage++,s=!0,this.sm.forceaugmente.play()),e[3]&&e[1]&&this.player.numberStoneBlue>=achat&&(this.player.numberStoneBlue-=achat,this.player.def+=.5,s=!0,this.sm.peaudebelier.play()),e[3]&&e[2]&&this.player.numberStoneGreen>=achat&&(this.player.numberStoneGreen-=achat,this.player.MAX_SPEED+=50,this.sm.vitessedepegase.play(),s=!0)),s||(this.sm.mauvaisecombinaison.play(),this.sm.error.play()),this.initItemFusion()}},GUI.prototype.back=function(){this.game.sound.stopAll(),this.game.state.start("menu")},Kamikaze=function(t,e,i,s,a,h,o,r,n,l){this.player=h,this.speed=s,this.spikeSpeed=200,this.domage=n,this.hp=a,this.chance=o,this.nbrR=Math.floor(r*Math.random())+1,this.exploded=!1,this.angleMax=.5,this.distance=100,this.sm=l,this.spikes=i.add.group(),this.spikes.enableBody=!0,Phaser.Sprite.call(this,i,t,e,"kamikaze"),this.scale.setTo(.2,.2),i.physics.enable(this,Phaser.Physics.ARCADE),this.body.collideWorldBounds=!1,this.body.checkCollision.up=!1,this.body.checkCollision.down=!1,this.body.checkCollision.left=!1,this.body.checkCollision.right=!1,this.exploding=!1,this.anchor.set(.5),this.timerDomage=0},Kamikaze.prototype=Object.create(Phaser.Sprite.prototype),Kamikaze.prototype.action=function(t,e,i){return this.game.physics.arcade.overlap(this.player.turrets,this.spikes,this.spikeCollision,null,this),this.game.physics.arcade.overlap(this.player,this.spikes,this.spikeCollision,null,this),this.alive?(Phaser.Point.distance(this.position,this.player.position)<this.distance&&!this.exploding?(this.body.velocity.x=0,this.body.velocity.y=0,this.game.time.events.add(1*Phaser.Timer.SECOND,this.explode,this),this.exploding=!0):this.exploding||this.homing(),this.hp<=0?(this.dropResource(e),void this.destroy()):void(this.exploded&&(this.kill(),this.game.time.events.add(4*Phaser.Timer.SECOND,this.destroy,this)))):void 0},Kamikaze.prototype.dropResource=function(){Math.random()<this.chance&&powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),!0,this.nbrR)),Math.random()<.05&&powerups.add(new Powerups(this.x,this.y,this.game,"heart",!0,1))},Kamikaze.prototype.hurt=function(t,e){3!==e&&this.sm.enemyhurt.play(),this.hp-=t},Kamikaze.prototype.explode=function(){var t=0
if(this.alive){this.sm.turretneutretir.play()
for(var e=0;10>e;e++)spike=this.spikes.create(this.body.x,this.body.y,"bullet"),spike.body.velocity.x=Math.cos(t)*this.spikeSpeed,spike.body.velocity.y=Math.sin(t)*this.spikeSpeed,spike.lifespan=4e3,t+=2*Math.PI/10
this.exploded=!0}},Kamikaze.prototype.homing=function(){var t
t=this.game.math.angleBetween(this.x,this.y,this.player.x,this.player.y)
var e=(this.angle-90)*(Math.PI/180)
if(e!==t){var i=t-e
i>Math.PI?i-=2*Math.PI:i<-Math.PI&&(i+=2*Math.PI),Math.abs(i)<this.angleMax?e=t:i>0?e+=this.angleMax:e-=this.angleMax}this.body.velocity.x=Math.cos(e)*this.speed,this.body.velocity.y=Math.sin(e)*this.speed,this.rotation=e,this.angle+=90},Kamikaze.prototype.spikeCollision=function(t,e){t.hurt(100*this.domage),e.destroy()},Kamikaze.prototype.slowDown=function(){ennemibouffecore.isPlaying||this.sm.ennemibouffecore.play(),this.body.velocity.x=-10,this.body.gravity.y=0,this.body.velocity.y=0},MasterTurret=function(t,e,i,s,a,h,o,r,n,l){Phaser.Sprite.call(this,i,t,e,"boss"),this.animations.add("left",[0,1,2],5,!0),this.animations.add("notMove",[0],5,!0),this.anchor.x=.5,this.anchor.y=.1,scalex=.3,this.scale.x=scalex,this.scale.y=.3,this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.time=0,this.distance=1e3,this.sm=l,this.hp=o,this.nbrMissile=a,this.cooldown=h,this.domage=s,this.rayon=r,this.cooldownTemp=0,this.turretList=[],this.changeTurretList=[],this.nbResMax=n,this.bullets=this.game.add.group(),this.bullets.enableBody=!0,this.spikes=i.add.group(),this.spikes.enableBody=!0,this.eventFire,this.nbrExplose=3,this.currentNbrExplose=1,this.tween,this.direction,this.timePause=0,this.moveLeft()},MasterTurret.prototype=Object.create(Phaser.Sprite.prototype),MasterTurret.prototype.moveRigth=function(){this.tween=this.game.add.tween(this).to({x:this.x+800},15e3),this.tween.onComplete.add(this.moveLeft,this),this.tween.start(3e3),this.animations.play("left"),this.scale.x=-scalex,this.direction="right"},MasterTurret.prototype.moveLeft=function(){this.tween=this.game.add.tween(this).to({x:this.x-800},15e3),this.tween.onComplete.add(this.moveRigth,this),this.tween.start(3e3),this.animations.play("left"),this.scale.x=scalex,this.direction="left"},MasterTurret.prototype.reviveJungle=function(t,e,i,s,a){this.revive(),this.hp=t,this.nbrMissile=i,this.cooldown=s,this.domage=e,this.nbResMax=a,this.cooldownTemp=0,this.x=2100,this.y=50,this.bullets=this.game.add.group(),this.bullets.enableBody=!0,this.eventFire,this.direction,this.timePause=0,this.moveLeft()},MasterTurret.prototype.action=function(t,e,i,s){var a=Phaser.Point.distance(this.position,s.position)
if(a<this.distance&&!this.sm.drum1.isPlaying&&s.y<570&&this.alive?this.sm.drum1.play("",0,1,!0):(a>this.distance||s.y>=570||!this.alive)&&this.sm.drum1.stop(),this.alive!==!1){if(this.hp<=0){this.createResource(),i.timeJungleSpwan=this.game.time.now+1e5
for(var h in this.bullets.children)this.bullets.children[h].graphic.destroy()
return this.bullets.destroy(),this.kill(),this.tween.stop(),void this.game.time.events.remove(this.eventFire)}this.time+=this.game.time.elapsed
var o=this.cooldownTemp
this.turretList=[],this.changeTurretList=[]
for(var h in this.bullets.children)3===this.bullets.children[h].behavior&&this.turretList.push(this.bullets.children[h].target),this.bullets.children[h].needChangeTarget&&this.changeTurretList.push(this.bullets.children[h])
for(var h in this.changeTurretList)if(-1!==this.turretList.indexOf(s)){for(var r in s.turrets.children)if(-1===this.turretList.indexOf(s.turrets.children[r])){var n=Phaser.Point.distance(this.position,s.turrets.children[r].position)
n<this.rayon&&(this.changeTurretList[h].target=s.turrets.children[r],this.changeTurretList[h].needChangeTarget=!1,this.turretList.push(s.turrets.children[r]))}}else this.changeTurretList[h].target=s,this.changeTurretList[h].needChangeTarget=!1,this.turretList.push(s)
o<=this.time&&this.shootMissile(s,o)
for(var h in this.bullets.children)this.bullets.children[h].actionMissile()
this.game.physics.arcade.overlap(s,this.bullets,this.collisionMissile,null,this),this.game.physics.arcade.overlap(s,this.spikes,this.spikeCollision,null,this),this.tween.isPaused&&this.timePause<=this.game.time.now&&(this.animations.play("left"),this.tween.resume(),this.timePause=0)}},MasterTurret.prototype.createResource=function(){powerups.add(new Powerups(this.x,this.y,this.game,"redstone",!0,Math.floor(this.nbResMax*Math.random())+1)),powerups.add(new Powerups(this.x,this.y,this.game,"greenstone",!0,Math.floor(this.nbResMax*Math.random())+1)),powerups.add(new Powerups(this.x,this.y,this.game,"bluestone",!0,Math.floor(this.nbResMax*Math.random())+1))},MasterTurret.prototype.collisionMissile=function(t,e){2===e.behavior||4===e.behavior?e.timeDomageEffet<this.game.time.now&&(t.hurt(25*this.domage),e.timeDomageEffet=this.game.time.now+1e3):(t.hurt(100*this.domage),e.needDestroy=!0)},MasterTurret.prototype.spikeCollision=function(t,e){t.hurt(100*this.domage),e.destroy()},MasterTurret.prototype.shootMissile=function(t,e){var i=this.nbrMissile,s=!1,a=Phaser.Point.distance(this.position,t.position)
a<this.rayon&&(this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t,this.rayon,1,this.domage,4e3)),this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t,this.rayon,3,this.domage,4e3)),i-=1,s||(this.currentNbrExplose=1,this.explode(0)),s=!0)
for(var h in t.turrets.children){if(0>=i)break
a=Phaser.Point.distance(this.position,t.turrets.children[h].position),a<this.rayon&&(this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.turrets.children[h],this.rayon,1,this.domage,5e3)),this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.turrets.children[h],this.rayon,3,this.domage,5e3)),i-=1,s||(this.currentNbrExplose=1,this.explode(0)),s=!0)}s&&(this.tween.pause(),this.timePause=this.game.time.now+4e3,this.animations.play("notMove"),this.time=0,this.cooldownTemp=this.cooldown)},MasterTurret.prototype.explode=function(t){var e=t*(Math.PI/180)
if(this.alive){for(var i=0;10>i;i++)spike=this.spikes.create(this.x,this.y,"bullet"),spike.body.velocity.x=200*Math.cos(e),spike.body.velocity.y=200*Math.sin(e),spike.lifespan=4e3,e+=2*Math.PI/10
this.sm.turretneutretir.play()}this.currentNbrExplose>=this.nbrExplose||(this.currentNbrExplose++,0===t?this.eventFire=this.game.time.events.add(1e3,this.explode,this,18):this.eventFire=this.game.time.events.add(1e3,this.explode,this,0))},MasterTurret.prototype.hurt=function(t,e){3!==e&&this.sm.enemyhurt.play(),this.hp-=t},MyGame.Menu=function(t){this.music=null,this.playButton=null},MyGame.Menu.prototype={create:function(){this.music=this.add.audio("maintheme"),this.music.play("",0,1,!0),click=this.add.audio("clic"),choice=this.add.audio("playertire"),this.playMusic=!0,this.world.setBounds(0,0,1024,600),this.stage.backgroundColor="#000000",this.titleSprite=this.add.sprite(this.world.centerX,this.world.centerY-170,"title"),this.titleSprite.anchor.setTo(.5,.5),this.titleSprite.scale.setTo(1.5,2),this.playButton=this.add.button(this.world.centerX,this.world.centerY,"play-button",this.startGame,this,2,1,0,2),this.playButton.anchor.setTo(.5,.5),this.playButton.scale.setTo(4,2),this.playButton.onInputOver.add(over,this),this.playButton.onInputOut.add(out,this),this.optionsButton=this.add.button(this.world.centerX,this.world.centerY+110,"options-button",this.showOptions,this,2,1,0,2),this.optionsButton.scale.setTo(4,2),this.optionsButton.anchor.setTo(.5,.5),this.optionsButton.onInputOver.add(over,this),this.optionsButton.onInputOut.add(out,this),this.controlsButton=this.add.button(this.world.centerX,this.world.centerY+220,"controls-button",this.showControls,this,2,1,0,2),this.controlsButton.scale.setTo(4,2),this.controlsButton.anchor.setTo(.5,.5),this.controlsButton.onInputOver.add(over,this),this.controlsButton.onInputOut.add(out,this),this.backButton=this.add.button(1600,this.world.centerY+250,"back-button",this.back,this,2,1,0,2),this.backButton.scale.setTo(4,2),this.backButton.anchor.setTo(.5,.5),this.backButton.onInputOver.add(over,this),this.backButton.onInputOut.add(out,this),this.optionsList=this.add.sprite(1e3,0,"options"),this.optionFullScreen=this.add.button(1600,this.world.centerY-93,"cursor",this.fullscreen,this,2,1,0,2),this.optionFullScreen.scale.setTo(.5,.5),this.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.optionMusic=this.add.button(1600,this.world.centerY-13,"cursor",this.noMusic,this,2,1,0,2),this.optionMusic.scale.setTo(.5,.5),this.optionSound=this.add.button(1600,this.world.centerY+63,"cursor",this.mute,this,2,1,0,2),this.optionSound.scale.setTo(.5,.5),this.controlsList=this.add.sprite(1e3,0,"controls")},update:function(){},startGame:function(t){this.music.stop(),this.state.start("game")},showOptions:function(t){choice.play(),this.removeTitle(),this.add.tween(this.optionsList).to({x:0},500,"Linear",!0),this.add.tween(this.backButton).to({x:this.world.centerX},500,"Linear",!0),this.add.tween(this.optionFullScreen).to({x:this.world.centerX+160},500,"Linear",!0),this.add.tween(this.optionMusic).to({x:this.world.centerX+160},500,"Linear",!0),this.add.tween(this.optionSound).to({x:this.world.centerX+160},500,"Linear",!0)},back:function(t){choice.play(),this.add.tween(this.titleSprite).to({x:500},500,"Linear",!0),this.add.tween(this.playButton).to({x:500},500,"Linear",!0),this.add.tween(this.optionsButton).to({x:500},500,"Linear",!0),this.add.tween(this.controlsButton).to({x:500},500,"Linear",!0),this.add.tween(this.optionsList).to({x:1e3},500,"Linear",!0),this.add.tween(this.backButton).to({x:1600},500,"Linear",!0),this.add.tween(this.optionFullScreen).to({x:1600},500,"Linear",!0),this.add.tween(this.optionMusic).to({x:1600},500,"Linear",!0),this.add.tween(this.optionSound).to({x:1600},500,"Linear",!0),this.add.tween(this.controlsList).to({x:1e3},500,"Linear",!0)},showControls:function(t){choice.play(),this.removeTitle(),this.add.tween(this.controlsList).to({x:0},500,"Linear",!0),this.add.tween(this.backButton).to({x:this.world.centerX},500,"Linear",!0)},removeTitle:function(){this.add.tween(this.titleSprite).to({x:-500},500,"Linear",!0),this.add.tween(this.playButton).to({x:-500},500,"Linear",!0),this.add.tween(this.optionsButton).to({x:-500},500,"Linear",!0),this.add.tween(this.controlsButton).to({x:-500},500,"Linear",!0)},fullscreen:function(t){choice.play(),this.scale.isFullScreen?this.scale.stopFullScreen():this.scale.startFullScreen(!1)},mute:function(t){choice.play(),this.sound.mute?this.sound.mute=!1:this.sound.mute=!0},noMusic:function(t){choice.play(),this.music.mute?(this.music.mute=!1,this.playMusic=!0):(this.music.mute=!0,this.playMusic=!1)}},Minion=function(t,e,i,s,a,h,o,r,n,l){this.speed=s,this.hp=a,this.domage=n,this.chance=o,this.nbrR=Math.floor(r*Math.random())+1,this.type=h,this.sm=l,1===h?(Phaser.Sprite.call(this,i,t,e,"zombie"),this.animations.add("left",[0,1,0,2],4,!0),this.animations.play("left"),this.anchor.set(.5),this.scale.setTo(.1,.1)):2===h?(this.sm.warcry.play(),Phaser.Sprite.call(this,i,t,e,"birds"),this.animations.add("left",[0,1,2,3],5,!0),this.animations.play("left"),this.anchor.set(.5),this.scale.setTo(.15,.15)):(Phaser.Sprite.call(this,i,t,e,"fatass"),this.animations.add("left",[0,1,0,2],5,!0),this.animations.play("left"),this.anchor.set(.5),this.scale.setTo(.55,.55)),i.physics.enable(this,Phaser.Physics.ARCADE),this.body.velocity.x=-s,2!==h&&(this.body.gravity.y=500),this.body.collideWorldBounds=!0,this.timerDomage=0},Minion.prototype=Object.create(Phaser.Sprite.prototype),Minion.prototype.action=function(t,e,i){this.hp<=0&&(this.createResource(e),this.sm.drum2.stop(),this.destroy()),3!==this.type||drum2.isPlaying||this.sm.drum2.play("",0,1,!0)},Minion.prototype.createResource=function(){Math.random()<this.chance&&powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),!0,this.nbrR)),Math.random()<.05&&powerups.add(new Powerups(this.x,this.y,this.game,"heart",!0,1))},Minion.prototype.hurt=function(t,e){3!==e&&this.sm.enemyhurt.play(),this.hp-=t},Enemy.prototype.displayHP=function(){this.text.setText(this.hp),this.text.x=this.body.x,this.text.y=this.body.y-30},Minion.prototype.slowDown=function(){this.sm.ennemibouffecore.isPlaying||this.sm.ennemibouffecore.play(),this.body.velocity.x=-10,this.body.gravity.y=0,this.body.velocity.y=0},Bullet=function(t,e,i,s,a,h,o,r,n,l,d){if(this.speed=300,this.angleMax=.5,this.behavior=o,this.domage=r,this.timeLive=n,this.rayon=h,this.timeDomageEffet=s.time.now,this.nbScale=.1,this.facing=d,this.timeLaser=0,this.sm=t,this.lasers=s.add.audio("laser"),homingmissile=s.add.audio("homingmissile"),this.tween,this.time=0,this.needDestroy=!1,this.needChangeTarget=!1,this.target=a,this.pointDestination=l,this.stop=!1,this.graphic=s.add.graphics(0,0),2===o){var u=this.sm.boomerang.play("boomerangSec")
u.volume=3,Phaser.Sprite.call(this,s,e,i,"boomerang")}else 4===o?this.circle(s,e,i):1===o?(Phaser.Sprite.call(this,s,e,i,"missile"),this.scale.setTo(.15,.15),this.sm.turretneutretir.play(),this.trackSound=homingmissile.play()):(Phaser.Sprite.call(this,s,e,i,"bullet"),this.scale.setTo(.6,.6))
this.anchor.setTo(.5,.5),3===o&&(this.trackLaser=this.lasers.play(),this.kill())},Bullet.prototype=Object.create(Phaser.Sprite.prototype),Bullet.prototype.actionMissile=function(){if(this.time+=this.game.time.elapsed,this.graphic.clear(),this.graphic.position=new Phaser.Point,this.time>=this.timeLive||this.needDestroy)return 1===this.behavior?this.trackSound.destroy():3===this.behavior&&this.trackLaser.destroy(),void this.destroy()
switch(this.behavior){case-1:this.simpleFireTurret()
break
case 0:this.simpleFire()
break
case 1:case 5:this.homing()
break
case 2:this.boomerang()
break
case 3:this.laser()
break
case 4:this.ajuster()}},Bullet.prototype.simpleFireTurret=function(){if(!this.stop){this.sm.turretneutretir.play()
var t=this.game.math.angleBetween(this.x,this.y,this.target.x,this.target.y),e=Math.cos(t)*this.rayon+this.x,i=Math.sin(t)*this.rayon+this.y
this.timeLive=1e3,this.tween=this.game.add.tween(this).to({x:e,y:i},this.timeLive),this.tween.start(),this.tween.onComplete.removeAll(),this.stop=!0}},Bullet.prototype.simpleFire=function(){if(!this.stop){this.sm.playertire.play()
var t=600
"left"===this.facing?this.body.velocity.x=-t:"right"===this.facing?this.body.velocity.x=t:"up"===this.facing?this.body.velocity.y=-t:"down"===this.facing&&(this.body.velocity.y=t),this.stop=!0}},Bullet.prototype.homing=function(){var t
if(t=1===this.behavior?this.game.math.angleBetween(this.x,this.y,this.target.x,this.target.y):this.game.math.angleBetween(this.x,this.y,this.pointDestination.x,this.pointDestination.y),this.rotation!==t){var e=t-this.rotation
e>Math.PI?e-=2*Math.PI:e<-Math.PI&&(e+=2*Math.PI),Math.abs(e)<this.angleMax?this.rotation=t:e>0?this.rotation+=this.angleMax:this.rotation-=this.angleMax}this.body.velocity.x=Math.cos(this.rotation)*this.speed,this.body.velocity.y=Math.sin(this.rotation)*this.speed},Bullet.prototype.boomerang=function(){if(this.stop)return void(this.rotation+=.2)
this.timeLive=3e3
var t=this.game.math.angleBetween(this.x,this.y,this.target.x,this.target.y),e=Math.cos(t)*this.rayon+this.x,i=Math.sin(t)*this.rayon+this.y
this.tween=this.game.add.tween(this).to({x:e,y:i},this.timeLive/2),this.tween.yoyo(!0),this.tween.start(),this.tween.onComplete.removeAll(),this.stop=!0},Bullet.prototype.laser=function(){this.graphic.lineStyle(5,16711680,1)
var t=Phaser.Point.distance(this.position,this.target.position)
return t>=this.rayon||!this.target.alive?(this.needChangeTarget=!0,void this.trackLaser.stop()):(this.trackLaser.isPlaying||this.trackLaser.play(),this.graphic.moveTo(this.x,this.y),this.graphic.lineTo(this.target.x,this.target.y),void(this.timeLaser<this.game.time.now&&(this.target.hurt(5*this.domage,this.behavior),this.timeLaser=this.game.time.now+100)))},Bullet.prototype.circle=function(t,e,i){this.graphic.beginFill(8917265,.15),this.graphic.drawCircle(e,i,this.rayon),this.graphic.endFill(),Phaser.Sprite.call(this,t,e,i,this.graphic.generateTexture()),this.scale.setTo(.1,.1)},Bullet.prototype.ajuster=function(){this.stop||(this.tween=this.game.add.tween(this.scale).to({x:1,y:1},this.timeLive/2),this.tween.yoyo(!0),this.tween.start(),this.tween.onComplete.removeAll(),this.stop=!0)},Player=function(t,e,i,s){MAX_SPEED=300,this.sm=s,this.maxspeed=MAX_SPEED,this.friction=20,this.numberStoneBlue=0,this.numberStoneRed=0,this.numberStoneGreen=0,this.health=10,this.shotTime=0,this.isRight=!0,this.timerDomage=0,this.domage=1,this.def=1,Phaser.Sprite.call(this,i,t,e,"player"),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.gravity.y=600,this.body.collideWorldBounds=!0,this.body.checkCollision.up=!1,this.animations.add("idleRight",[0,1,2],5,!0),this.animations.add("idleLeft",[9,10,11],5,!0),this.animations.add("right",[3,4,5],5,!0),this.animations.add("left",[6,7,8],5,!0),this.anchor.set(.5),this.playerFacing="right",this.animations.play("idleRight"),this.actionKey_shift=this.game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),this.actionKey_T=this.game.input.keyboard.addKey(Phaser.Keyboard.T),this.actionKey_T.onDown.add(this.creationTurret,this),this.actionKey_Q=this.game.input.keyboard.addKey(Phaser.Keyboard.Q),this.actionKey_W=this.game.input.keyboard.addKey(Phaser.Keyboard.W),this.actionKey_R=this.game.input.keyboard.addKey(Phaser.Keyboard.R),this.actionKey_E=this.game.input.keyboard.addKey(Phaser.Keyboard.E),this.actionKey_Z=this.game.input.keyboard.addKey(Phaser.Keyboard.Z),this.actionKey_Z.onDown.add(this.cheat,this),this.cursors=this.game.input.keyboard.createCursorKeys(),this.actionKey_A=this.game.input.keyboard.addKey(Phaser.Keyboard.A),this.maxTurrets=5,this.nbrTurrets=0,this.bonus1=!1,this.bonus2=!1,this.bonus3=!1},Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.action=function(t,e,i){this.body.acceleration.y=0
for(var s in this.bullets.children)this.bullets.children[s].actionMissile()
this.game.physics.arcade.collide(this,t),this.game.physics.arcade.overlap(player,i,this.collisionPlayerPowerUp,null,this),this.game.physics.arcade.overlap(player,this.turrets,this.removeTurret,null,this),this.game.physics.arcade.overlap(this.turrets,i,this.upGradeTurret,null,this),this.game.physics.arcade.overlap(player,e,this.hurtPlayer,null,this),this.game.physics.arcade.overlap(this.turrets,e,this.destroyTurret,null,this),this.game.physics.arcade.overlap(this.bullets,e,this.hurtTarget,null,this),this.actionKey_A.isDown?this.fire():this.move(),this.manageSpeed(),this.launchResource(i)
for(var s in this.turrets.children)this.turrets.children[s].actionTurret(e,i,this)
this.game.time.now>player.timerDomage&&(this.tint=16777215),this.y>1120&&(this.y=1e3),this.flash.visible===!0&&(this.flash.x=this.x,this.flash.y=this.y-74,this.flash.angle+=10)},Player.prototype.fire=function(t){this.body.velocity.x=0,this.game.time.now>this.shotTime&&(this.cursors.right.isDown?(this.shotTime=this.game.time.now+400,this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"right"))):this.cursors.left.isDown?(this.shotTime=this.game.time.now+400,this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"left"))):this.cursors.up.isDown?(this.shotTime=this.game.time.now+400,this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"up"))):this.cursors.down.isDown&&(this.shotTime=this.game.time.now+400,this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"down"))))},Player.prototype.launchResource=function(t){if(this.game.time.now>this.shotTime){if(this.x>this.game.world.width-100||this.x<150)return
var e=null
if(this.actionKey_Q.isDown&&this.numberStoneRed>0?(e="redstone",this.numberStoneRed--):this.actionKey_W.isDown&&this.numberStoneBlue>0?(e="bluestone",this.numberStoneBlue--):this.actionKey_E.isDown&&this.numberStoneGreen>0&&(e="greenstone",this.numberStoneGreen--),null==e)return
this.shotTime=this.game.time.now+400
var i=0
i=this.isRight?200:-200
var s=new Powerups(this.x,this.y,this.game,e,!1,1)
t.add(s),s.body.velocity.x=i,s.body.gravity.y=100}},Player.prototype.move=function(){this.cursors.left.isDown?(this.isRight=!1,this.body.velocity.x-=50,"left"!==this.playerFacing&&(this.animations.play("left"),this.playerFacing="left")):this.cursors.right.isDown?(this.isRight=!0,this.body.velocity.x+=50,"right"!==this.playerFacing&&(this.animations.play("right"),this.playerFacing="right")):"idle"!==this.playerFacing&&(this.animations.stop(),"left"===this.playerFacing?this.animations.play("idleLeft"):this.animations.play("idleRight"),this.playerFacing="idle"),this.cursors.up.isDown&&this.body.touching.down&&(this.body.velocity.y=-400,this.sm.playerjump.play()),this.body.touching.down||("left"===this.playerFacing?this.frame=12:"idle"===this.playerFacing?this.frame=13:"right"===this.playerFacing&&(this.frame=14)),!this.body.touching.down&&this.cursors.down.isDown&&(this.body.acceleration.y=2e3),this.body.touching.down&&this.cursors.down.isDown&&this.actionKey_shift.isDown&&this.body.y<1e3&&(this.body.checkCollision.down=!1),(this.actionKey_shift.isUp||this.body.y>1e3)&&(this.body.checkCollision.down=!0)},Player.prototype.creationTurret=function(){this.nbrTurrets<this.maxTurrets&&(this.flash.visible=!1,this.sm.construction.play(),this.turrets.add(new Turret(this.x+30,this.y-50,this.game,this.bonus1,this.bonus2,this.bonus3,this.sm)),this.bonus1=this.bonus2=this.bonus3=!1,this.nbrTurrets++)},Player.prototype.manageSpeed=function(){this.actionKey_shift.isDown?this.maxspeed=1.5*MAX_SPEED:this.maxspeed=MAX_SPEED,this.body.velocity.x>this.maxspeed&&(this.body.velocity.x=this.maxspeed),this.body.velocity.x<-this.maxspeed&&(this.body.velocity.x=-this.maxspeed),this.body.velocity.x>0&&(this.body.velocity.x-=this.friction,this.body.velocity.x<0&&(this.body.velocity.x=0)),this.body.velocity.x<0&&(this.body.velocity.x+=this.friction,this.body.velocity.x>0&&(this.body.velocity.x=0))},Player.prototype.collisionPlayerPowerUp=function(t,e){if(e.collidePlayer&&e.alive){switch(this.sm.pickup.play(),e.key){case"redstone":t.numberStoneRed+=e.number
break
case"greenstone":t.numberStoneGreen+=e.number
break
case"bluestone":t.numberStoneBlue+=e.number
break
case"heart":t.health<10&&t.health++
break
case"turret":t.nbrTurrets--}e.alive=!1}},Player.prototype.upGradeTurret=function(t,e){if(e.alive){switch(e.key){case"redstone":3===t.kind?t.rayon<1e3&&(t.rayon=t.rayon+25):(t.kind=3,t.tint=16711680)
break
case"greenstone":2===t.kind?t.cooldown>1e3&&(t.cooldown=t.cooldown-125):(t.kind=2,t.tint=2672384)
break
case"bluestone":1===t.kind?t.numberEnemyShoot<10&&(t.numberEnemyShoot+=.225):(t.kind=1,t.tint=44769)}"heart"!==e.key&&"turret"!==e.key&&(t.domage=t.domage+.5,e.alive=!1,this.sm.turretfeed.play())}},Player.prototype.hurt=function(t){this.health-=t/100/this.def,this.sm.playerhurt.play()},Player.prototype.hurtPlayer=function(t,e){this.game.time.now>t.timerDomage&&(t.health-=e.domage/this.def,t.timerDomage=this.game.time.now+1e3,this.tint=16711680,this.sm.playerhurt.play())},Player.prototype.hurtTarget=function(t,e){t.needDestroy||(e.hurt(50*this.domage),t.needDestroy=!0)},Player.prototype.destroyTurret=function(t,e){this.game.time.now>e.timerDomage&&t.hurt(20*e.domage,e)},Player.prototype.cheat=function(){this.numberStoneBlue+=10,this.numberStoneRed+=10,this.numberStoneGreen+=10,this.maxTurrets+=10},Player.prototype.removeTurret=function(t,e){this.actionKey_R.isDown&&(e.hp=0)},Powerups=function(t,e,i,s,a,h){Phaser.Sprite.call(this,i,t,e,s),this.anchor.x=.5,this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.scale.setTo(.35,.35),"turret"===s&&this.scale.setTo(.15,.15),this.collidePlayer=a,this.number=h},Powerups.prototype=Object.create(Phaser.Sprite.prototype),Powerups.prototype.action=function(){if(!this.alive)return void this.destroy()
var t=this.body.velocity.x
if(t>0&&this.body.touching.down){var e=10
10>=t&&(e=t,this.collidePlayer=!0),this.body.velocity.x-=e}if(0>t&&this.body.touching.down){var e=-10
t>=-10&&(e=t,this.collidePlayer=!0),this.body.velocity.x-=e}(this.x>this.game.world.width-50||this.x<50)&&(this.body.velocity.x=0,this.collidePlayer=!0)},MyGame.Preloader=function(t){this.loadingBar=null,this.ready=!1},MyGame.Preloader.prototype={preload:function(){this.loadingBar=this.add.sprite(this.world.centerX,this.world.centerY,"loading"),this.loadingBar.anchor.setTo(.5,.5),this.load.setPreloadSprite(this.loadingBar,0),this.load.image("title","assets/title.png"),this.load.image("play-button","assets/play-button.png"),this.load.image("options-button","assets/options-button.png"),this.load.image("controls-button","assets/controls-button.png"),this.load.image("cursor","assets/cursor.png"),this.load.image("options","assets/options.png"),this.load.image("back-button","assets/back-button.png"),this.load.image("controls","assets/controls.png"),this.load.image("reset-button","assets/reset-button.png"),this.load.image("fond_degrader","assets/fond_degrader.png"),this.load.image("skin","assets/skin.png"),this.load.image("platform","assets/platform.png"),this.load.image("platform2","assets/platform2.png"),this.load.image("grass","assets/grass.png"),this.load.image("ground","assets/ground.png"),this.load.image("jungleground","assets/jungleground.png"),this.load.image("fond1","assets/fond1.png"),this.load.image("turret","assets/turret.png"),this.load.image("bullet","assets/bullet.png"),this.load.image("boomerang","assets/boomerang.png"),this.load.image("missile","assets/missile.png"),this.load.spritesheet("player","assets/player.png",50,100),this.load.image("flash","assets/flash.png"),this.load.spritesheet("enemy","assets/ennemies.png",50,100),this.load.spritesheet("birds","assets/birds.png",600,300),this.load.spritesheet("zombie","assets/zombie.png",500,1e3),this.load.spritesheet("puker","assets/puker.png",500,1e3),this.load.spritesheet("fatass","assets/fatass.png",500,1e3),this.load.image("kamikaze","assets/kamikaze.png"),this.load.spritesheet("boss","assets/boss.png",500,1e3),this.add.audio("maintheme"),this.load.audio("maintheme","assets/audio/themesong.mp3"),this.load.audio("level","assets/audio/level1.mp3"),this.load.audio("forceaugmente","assets/audio/forceaugmente.mp3"),this.load.audio("clic","assets/audio/clic.mp3"),this.load.audio("birds","assets/audio/birds.mp3"),this.load.audio("boomerang","assets/audio/boomerang.mp3"),this.load.audio("capaciteaugmente","assets/audio/capaciteaugmente.mp3"),this.load.audio("construction","assets/audio/construction.mp3"),this.load.audio("drum1","assets/audio/drum1.mp3"),this.load.audio("drum2","assets/audio/drum2.mp3"),this.load.audio("enemyhurt","assets/audio/enemyhurt.mp3"),this.load.audio("ennemibouffecore","assets/audio/ennemibouffecore.mp3"),this.load.audio("error","assets/audio/error.mp3"),this.load.audio("fusion","assets/audio/fusion.mp3"),this.load.audio("gong","assets/audio/gong.mp3"),this.load.audio("homingmissile","assets/audio/homingmissile.mp3"),this.load.audio("immunitedivine","assets/audio/immunitedivine.mp3"),this.load.audio("laser","assets/audio/laser.mp3"),this.load.audio("mauvaisecombinaison","assets/audio/mauvaisecombinaison.mp3"),this.load.audio("turretneutretir","assets/audio/turretneutretir.mp3"),this.load.audio("murdeboules","assets/audio/murdeboules.mp3"),this.load.audio("vitessedepegase","assets/audio/vitessedepegase.mp3"),this.load.audio("peaudebelier","assets/audio/peaudebelier.mp3"),this.load.audio("vousetesunechec","assets/audio/vousetesunechec.mp3"),this.load.audio("pickup","assets/audio/pickup.mp3"),this.load.audio("playerhurt","assets/audio/playerhurt.mp3"),this.load.audio("playerjump","assets/audio/playerjump.mp3"),this.load.audio("playertire","assets/audio/playertire.mp3"),this.load.audio("puker","assets/audio/puker.mp3"),this.load.audio("rayonbrutal","assets/audio/rayonbrutal.mp3"),this.load.audio("transitiondown","assets/audio/transitiondown.mp3"),this.load.audio("transitionup","assets/audio/transitionup.mp3"),this.load.audio("turretfeed","assets/audio/turretfeed.mp3"),this.load.audio("destroyturret","assets/audio/destroyturret.mp3"),this.load.image("heart","assets/heart.png"),this.load.image("redstone","assets/redstone.png"),this.load.image("bluestone","assets/bluestone.png"),this.load.image("greenstone","assets/greenstone.png"),this.load.image("gameover","assets/gameover.png"),this.load.image("fond_etoile","assets/fond_etoile.png"),this.load.image("wave","assets/wave.png")},create:function(){this.loadingBar.cropEnabled=!0},update:function(){this.cache.isSoundDecoded("maintheme")&&!this.ready&&(this.ready=!0,this.state.start("menu"))}},Puker=function(t,e,i,s,a,h,o,r,n,l){this.game=i,this.speed=s,this.domage=n,this.player=h,this.hp=a,this.chance=o,this.nbrR=Math.floor(r*Math.random())+1,this.sm=l,Phaser.Sprite.call(this,i,t,e,"puker"),i.physics.enable(this,Phaser.Physics.ARCADE),this.body.velocity.x=-s,this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.animations.add("left",[0,1,2],5,!0),this.animations.play("left"),this.anchor.set(.5),this.scale.setTo(.15,.15),this.timerDomage=0,this.timeRandom=Math.floor(6*Math.random()+5),this.eventFire=i.time.events.add(1e3*this.timeRandom,this.fire,this),this.nbFire=4,this.bullets=this.game.add.group(),this.bullets.enableBody=!0},Puker.prototype=Object.create(Phaser.Sprite.prototype),Puker.prototype.action=function(t,e,i){return this.hp<=0?(this.createResource(e),this.game.time.events.remove(this.eventFire),this.bullets.destroy(),void this.destroy()):(this.game.physics.arcade.overlap(this.player,this.bullets,this.hurtPlayer,null,this),void this.game.physics.arcade.overlap(this.player.turrets,this.bullets,this.hurtPlayer,null,this))},Puker.prototype.fire=function(){var t=this.game.add.sprite(this.x,this.y,"bullet")
if(4===this.nbFire){var e=this.sm.puke.play("puker3Sec")
e.volume=6}this.bullets.add(t),this.game.physics.enable(t,Phaser.Physics.ARCADE),t.body.gravity.y=200
var i=this.game.math.angleBetween(this.x,this.y,this.player.x,this.player.y)
t.body.velocity.x=400*Math.cos(i),t.body.velocity.y=400*Math.sin(i),this.nbFire>0?(this.eventFire=this.game.time.events.add(100,this.fire,this),this.nbFire--):(this.eventFire=this.game.time.events.add(1e3*this.timeRandom,this.fire,this),this.nbFire=4)},Puker.prototype.createResource=function(){Math.random()<this.chance&&powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),!0,this.nbrR)),Math.random()<.05&&powerups.add(new Powerups(this.x,this.y,this.game,"heart",!0,1))},Puker.prototype.hurt=function(t,e){3!==e&&this.sm.enemyhurt.play(),this.hp-=t},Puker.prototype.hurtPlayer=function(t,e){t.hurt(10*this.domage),e.destroy()},Puker.prototype.slowDown=function(){ennemibouffecore.isPlaying||this.sm.ennemibouffecore.play(),this.body.velocity.x=-10,this.body.gravity.y=0,this.body.velocity.y=0},SoundManager=function(t){this.boomerang=t.add.audio("boomerang"),this.boomerang.addMarker("boomerangSec",0,3),this.boomerang.allowMultiple=!0,this.turretneutretir=t.add.audio("turretneutretir"),this.turretneutretir.volume=.5,this.turretneutretir.allowMultiple=!0,this.playertire=t.add.audio("playertire"),this.enemyhurt=t.add.audio("enemyhurt"),this.ennemibouffecore=t.add.audio("ennemibouffecore"),this.ennemibouffecore.volume=4,this.warcry=t.add.audio("birds"),this.warcry.volume=.3,this.puke=t.add.audio("puker"),this.puke.addMarker("puker3Sec",0,3),this.puke.allowMultiple=!0,this.drum1=t.add.audio("drum1"),this.drum2=t.add.audio("drum2"),this.forceaugmente=t.add.audio("forceaugmente"),this.forceaugmente.volume=2,this.capaciteaugmente=t.add.audio("capaciteaugmente"),this.capaciteaugmente.volume=2,this.vitessedepegase=t.add.audio("vitessedepegase"),this.vitessedepegase.volume=2,this.rayonbrutal=t.add.audio("rayonbrutal"),this.rayonbrutal.volume=2,this.peaudebelier=t.add.audio("peaudebelier"),this.peaudebelier.volume=2,this.murdeboules=t.add.audio("murdeboules"),this.murdeboules.volume=2,this.immunitedivine=t.add.audio("immunitedivine"),this.mauvaisecombinaison=t.add.audio("mauvaisecombinaison"),this.error=t.add.audio("error"),this.vousetesunechec=t.add.audio("vousetesunechec"),this.gong=t.add.audio("gong"),this.gong.volume=.5,this.transitionup=t.add.audio("transitionup"),this.transitiondown=t.add.audio("transitiondown"),this.pickup=t.add.audio("pickup"),this.pickup.allowMultiple=!0,this.construction=t.add.audio("construction"),this.construction.allowMultiple=!0,this.playerhurt=t.add.audio("playerhurt"),this.playerjump=t.add.audio("playerjump"),this.turretfeed=t.add.audio("turretfeed"),this.destroyturret=t.add.audio("destroyturret")},Stage=function(t,e,i,s){this.game=t,this.player=e,this.sm=s,this.background_image=t.add.sprite(0,0,"fond_etoile"),this.background_image.alpha=0,t.add.tween(this.background_image).to({alpha:.8},25e3,Phaser.Easing.Exponential.InOut,!0,0,-1,!0),this.buildings=t.add.sprite(30,600,"fond1"),this.buildings.alpha=.3,this.game.world.setBounds(0,0,2200,1200),this.game.camera.y=1200,this.skin=this.game.add.sprite(-200,0,"skin"),this.ground,this.jungleGround,this.gameOver=!1,enemiesByWave=5,expansion=2,this.waveCount=0,this.timeWave=0,this.timeEscorte=0,this.newWave=!0,this.enemieToSpwan=5,this.timeJungleSpwan=0,this.domageJ=1,this.nbrMissileJ=1,this.cooldownJ=8e3,this.hpJ=500,this.royonJ=450,this.nbResMax=10,this.jungleEnemy=new MasterTurret(2100,50,this.game,this.domageJ,this.nbrMissileJ,this.cooldownJ,this.hpJ,this.royonJ,this.nbResMax,this.sm),i.add(this.jungleEnemy),this.nbItemBoss=0,this.IsShoot=!1,this.eventKami,this.vieGeneral=100,this.maxEnemie=104},Stage.prototype.action=function(t,e,i,s,a,h){this.game.physics.arcade.collide(i,this.platforms),this.game.physics.arcade.collide(s,this.platforms),this.game.physics.arcade.collide(h,this.platforms),this.game.physics.arcade.overlap(i,this.skin,this.slowEnemy,null,this),e.health<=0&&this.gameOver===!1&&(this.gameOver=!0,a.endGame(this.waveCount)),this.moveCamera(e),this.changeBackgroundColor(t.now%5e4),0!==this.timeJungleSpwan&&this.timeJungleSpwan<this.game.time.now&&(this.createJungle(i),this.timeJungleSpwan=0),(this.newWave&&this.timeWave<this.game.time.now||this.timeEscorte<this.game.time.now&&this.enemieToSpwan>0&&!this.newWave)&&(this.newWave&&(this.waveCount++,a.displayWave(this.waveCount),this.newWave=!1),this.timeEscorte=this.game.time.now+3e3,this.createWave(i,a)),1===i.children.length&&!this.newWave&&this.enemieToSpwan<=0&&(enemiesByWave<this.maxEnemie&&(enemiesByWave+=3),this.timeWave=this.game.time.now+15e3,11===this.waveCount?this.enemieToSpwan=10:14===this.waveCount?this.enemieToSpwan=5:this.enemieToSpwan=enemiesByWave,this.newWave=!0,this.IsShoot&&(this.game.time.events.remove(this.eventKami),this.IsShoot=!1))},Stage.prototype.changeBackgroundColor=function(t){if(25e3>=t)var e=130-.0052*t,i=253-.00532*t
else var s=t%25e3,e=.0052*s,i=120+.00532*s
this.game.stage.backgroundColor="#"+((1<<24)+(e<<16)+(i<<8)+255).toString(16).slice(1)},Stage.prototype.moveCamera=function(t){this.game.camera.x=t.x-512,t.y<570?this.game.camera.y>30&&(this.game.camera.y-=15,this.sm.transitionup.isPlaying||this.sm.transitionup.play()):this.game.camera.y<600&&(this.game.camera.y+=15,this.sm.transitiondown.isPlaying||this.sm.transitiondown.play())},Stage.prototype.createPlatforms=function(){this.platforms=this.game.add.group(),this.platforms.enableBody=!0,this.ground=this.platforms.create(0,1170,"ground"),this.game.physics.enable(this.skin,Phaser.Physics.ARCADE),this.jungleGround=this.platforms.create(0,600,"jungleground")
for(var t=300,e=0;5>e;e++){if(e%2===0)for(var i=0;4>i;i++){var s=1050-110*i
this.p=this.platforms.create(t,s,"platform"),this.p.scale.setTo(.7,.5)}else for(var i=0;3>i;i++){var s=1e3-110*i
this.p=this.platforms.create(t,s,"platform"),this.p.scale.setTo(.7,.5)}t+=400}this.p=this.platforms.create(1e3,500,"platform"),this.p.scale.setTo(.4,.5),this.p=this.platforms.create(1e3,400,"platform"),this.p.scale.setTo(.4,.5),this.p=this.platforms.create(1210,400,"platform"),this.p.scale.setTo(.4,.5),this.p=this.platforms.create(1420,400,"platform"),this.p.scale.setTo(.4,.5),this.p=this.platforms.create(1630,400,"platform"),this.p.scale.setTo(.4,.5),this.p=this.platforms.create(1840,400,"platform"),this.p.scale.setTo(.4,.5),this.p=this.platforms.create(2050,400,"platform"),this.p.scale.setTo(.4,.5),this.platforms.setAll("body.immovable",!0),this.platforms.setAll("body.checkCollision.down",!1),this.platforms.setAll("body.checkCollision.left",!1),this.platforms.setAll("body.checkCollision.right",!1),this.jungleGround.body.checkCollision.down=!0},Stage.prototype.slowEnemy=function(t,e){e.slowDown()},Stage.prototype.createJungle=function(t){this.nbResMax+=10,this.hpJ+=500,this.domageJ+=1,this.nbrMissileJ<5&&(this.nbrMissileJ+=1),this.cooldownJ>1e3&&(this.cooldownJ-=1e3),this.jungleEnemy.reviveJungle(this.hpJ,this.domageJ,this.nbrMissileJ,this.cooldownJ,this.nbResMax)},Stage.prototype.createZombie=function(t){if(!(this.enemieToSpwan<=0)){var e=50+this.vieGeneral*(this.waveCount-1),i=50,s=.8,a=1,h=1
t.add(new Minion(2e3,1100,this.game,i,e,1,s,a,h,this.sm)),this.enemieToSpwan--}},Stage.prototype.createBirds=function(t){var e=10+this.vieGeneral*(this.waveCount-1),i=.8,s=2,a=1,h=3
this.enemieToSpwan<h&&(h=this.enemieToSpwan)
for(var o=0;h>o;o++){var r=Math.floor(21*Math.random()+50)
t.add(new Minion(2e3,700+100*o,this.game,r,e,2,i,s,a,this.sm)),this.enemieToSpwan--}},Stage.prototype.createJumper=function(t){var e=3
this.enemieToSpwan<e&&(e=this.enemieToSpwan)
for(var i=100+this.vieGeneral*(this.waveCount-1),s=.7,a=3,h=1,o=0;e>o;o++){var r=Math.floor(31*Math.random()+40)
t.add(new Enemy(2e3,700+100*o,this.game,r,i,s,a,h,this.sm)),this.enemieToSpwan--}},Stage.prototype.createPuker=function(t){if(!(this.enemieToSpwan<=0)){var e=200+this.vieGeneral*(this.waveCount-1),i=40,s=.7,a=4,h=2
t.add(new Puker(2050,1e3,this.game,i,e,this.player,s,a,h,this.sm)),this.enemieToSpwan--}},Stage.prototype.createBoss=function(t){this.enemieToSpwan<=4&&(this.enemieToSpwan=0)
var e=600*this.waveCount,i=40,s=1
this.nbItemBoss=3
var a=3
t.add(new Minion(2e3,800,this.game,i,e,3,s,this.nbItemBoss,a,this.sm)),this.enemieToSpwan-=10},Stage.prototype.createWave=function(t,e){return 3===this.waveCount?void this.createBirds(t):7===this.waveCount?void this.createJumper(t):12===this.waveCount?void this.createPuker(t):15===this.waveCount?void(!this.IsShoot&&this.enemieToSpwan>0&&(this.createKamikaze(t),this.IsShoot=!0)):10===this.waveCount?void this.createBoss(t):(this.createZombie(t),this.waveCount>=3&&this.createBirds(t),this.waveCount>=7&&this.createJumper(t),this.waveCount>=12&&this.createPuker(t),this.waveCount>=15&&!this.IsShoot&&this.enemieToSpwan>0&&(this.createKamikaze(t),this.IsShoot=!0),void(this.waveCount>=18&&this.createBoss(t)))},Stage.prototype.createKamikaze=function(t){this.enemieToSpwan--
var e=100+this.vieGeneral*(this.waveCount-1),i=500,s=1,a=5,h=3
t.add(new Kamikaze(2050,1e3,this.game,i,e,this.player,s,a,h,this.sm))
var o=Math.floor(5*Math.random()+8)
this.eventKami=this.game.time.events.add(1e3*o,this.createKamikaze,this,t)},Turret=function(t,e,i,s,a,h,o){this.time=0,this.sm=o,Phaser.Sprite.call(this,i,t,e,"turret"),this.anchor.x=.5,this.scale.setTo(.25,.25),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.bonus1=s,this.bonus2=a,this.bonus3=h,this.hp=400,this.bullets=this.game.add.group(),this.bullets.enableBody=!0,this.numberEnemyShoot=1,this.cooldown=6e3,this.domage=1,this.rayon=250,this.cooldownTemp=0,this.kind=-1,this.enemyList=[],this.changeEnemyList=[]},Turret.prototype=Object.create(Phaser.Sprite.prototype),Turret.prototype.actionTurret=function(t,e,i){if(this.hp<=0){for(var s in this.bullets.children)this.bullets.children[s].graphic.destroy()
return this.bullets.destroy(),this.createResource(powerups),this.sm.destroyturret.play(),void this.destroy()}this.time+=this.game.time.elapsed
var a=this.cooldownTemp
this.enemyList=[],this.changeEnemyList=[]
for(var s in this.bullets.children)3===this.bullets.children[s].behavior&&this.enemyList.push(this.bullets.children[s].target),this.bullets.children[s].needChangeTarget&&this.changeEnemyList.push(this.bullets.children[s])
for(var s in this.changeEnemyList)for(var h in t.children)if(-1===this.enemyList.indexOf(t.children[h])){var o=Phaser.Point.distance(this.position,t.children[h].position)
o<this.rayon&&(this.changeEnemyList[s].target=t.children[h],this.changeEnemyList[s].needChangeTarget=!1,this.enemyList.push(t.children[h]))}a<=this.time&&this.shootMissile(t,a)
for(var s in this.bullets.children)this.bullets.children[s].actionMissile()
this.game.physics.arcade.overlap(this.bullets,t,this.collisionMissile,null,this)},Turret.prototype.createResource=function(){powerups.add(new Powerups(this.x,this.y,this.game,"turret",!0))},Turret.prototype.collisionMissile=function(t,e){2===t.behavior||4===t.behavior?t.timeDomageEffet<this.game.time.now&&(e.hurt(120*this.domage),t.timeDomageEffet=this.game.time.now+500):(e.hurt(200*this.domage),t.needDestroy=!0)},Turret.prototype.hurt=function(t,e){this.bonus3||(this.hp-=t,null!=e&&(e.timerDomage=this.game.time.now+1e3))},Turret.prototype.shootMissile=function(t,e){var i=Math.floor(this.numberEnemyShoot),s=!1
for(var a in t.children)if(!(t.children[a].y<600&&this.y>600)&&t.children[a].alive){if(0>=i)break
var h=Phaser.Point.distance(this.position,t.children[a].position)
if(h<this.rayon){if(this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.children[a],this.rayon,this.kind,this.domage,4e3)),i-=1,!s&&(this.bonus1&&this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.children[a],this.rayon,4,this.domage,4e3)),this.bonus2)){var o=new Phaser.Point(this.x+70,this.y-75),r=new Phaser.Point(this.x+70,this.y),n=new Phaser.Point(this.x+70,this.y+75)
this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.children[a],this.rayon,5,this.domage,4e3,o)),this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.children[a],this.rayon,5,this.domage,4e3,r)),this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,t.children[a],this.rayon,5,this.domage,4e3,n))}s=!0}}s&&(this.time=0,this.cooldownTemp=this.cooldown)}
