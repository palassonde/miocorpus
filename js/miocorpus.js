var MyGame={};MyGame.Boot=function(game){};MyGame.Boot.prototype={init:function(){this.stage.backgroundColor="#000000";if(this.game.device.desktop){this.scale.pageAlignVertically=true;this.scale.pageAlignHorizontally=true}else{this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL;this.scale.setMinMax(400,300,800,600);this.scale.forceLandscape=true;this.scale.pageAlignHorizontally=true}},preload:function(){this.game.load.image("loading","assets/loading.png")},create:function(){this.state.start("preloader")}};Enemy=function(x,y,game,speed,hp,chanceDrop,nbDrop,domage,sm){this.game=game;this.jumpTimer=0;this.jumpTime=500;this.jumpHeight=300;this.speed=speed;this.domage=domage;this.chance=chanceDrop;this.nbrR=Math.floor(nbDrop*Math.random())+1;this.hp=hp;this.sm=sm;Phaser.Sprite.call(this,game,x,y,"enemy");game.physics.enable(this,Phaser.Physics.ARCADE);this.body.velocity.x=-speed;this.body.gravity.y=500;this.body.collideWorldBounds=true;this.animations.add("left",[6,7,6,8],5,true);this.animations.play("left");this.anchor.set(.5);this.timerDomage=0};Enemy.prototype=Object.create(Phaser.Sprite.prototype);Enemy.prototype.action=function(time,powerups,stage){if(time.now-this.jumpTimer>=this.jumpTime){this.jump(time)}if(this.hp<=0){this.createResource(powerups);this.destroy()}};Enemy.prototype.createResource=function(){if(Math.random()<this.chance){powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),true,this.nbrR));if(Math.random()<this.chance){powerups.add(new Powerups(this.x+5,this.y,this.game,getRandomStone(),true,this.nbrR))}}if(Math.random()<.05){powerups.add(new Powerups(this.x,this.y,this.game,"heart",true,1))}};Enemy.prototype.hurt=function(dmg,behavior){if(!(behavior===3)){this.sm.enemyhurt.play()}this.hp-=dmg};Enemy.prototype.jump=function(time){if(Math.random()>.2){if(this.body.touching.down)this.body.velocity.y=-this.jumpHeight*(Math.random()+1)}this.jumpTimer=time.now};Enemy.prototype.slowDown=function(){if(!this.sm.ennemibouffecore.isPlaying){this.sm.ennemibouffecore.play()}this.body.velocity.x=-10;this.body.gravity.y=0;this.body.velocity.y=0};MyGame.Game=function(game){this.game;this.add;this.camera;this.cache;this.input;this.load;this.math;this.sound;this.stage;this.time;this.tweens;this.state;this.world;this.particles;this.physics;this.rnd};MyGame.Game.prototype={create:function(){music=this.add.audio("level");if(this.game.state.states["menu"].playMusic){music.play("",0,1,true)}sm=new SoundManager(this.game);this.game.physics.startSystem(Phaser.Physics.ARCADE);enemies=this.game.add.group();player=new Player(200,1e3,this.game,sm);this.game.add.existing(player);stage=new Stage(this.game,player,enemies,sm);stage.createPlatforms();gui=new GUI(this.game,stage,player,sm);powerups=this.game.add.group();player.turrets=this.game.add.group();player.turrets.enableBody=true;player.turrets.physicsBodyType=Phaser.Physics.ARCADE;player.bullets=this.game.add.group();player.bullets.enableBody=true;player.bringToTop();this.game.world.bringToTop(enemies);this.grass=this.game.add.sprite(0,1140,"grass");player.flash=this.game.add.sprite(this.x,this.y-20,"flash");player.flash.visible=false;player.flash.anchor.set(.5)},update:function(){player.action(stage.platforms,enemies,powerups);stage.action(this.time,player,enemies,player.turrets,gui,powerups);gui.action();for(var x in enemies.children){if(enemies.children[x].body.x<30&&stage.gameOver===false){stage.gameOver=true;gui.endGame(stage.waveCount)}enemies.children[x].action(this.time,powerups,stage,player)}for(var x in powerups.children){powerups.children[x].action()}}};function getRandomStone(){var random=Math.random();if(random<.333){return"redstone"}else if(random<.666){return"greenstone"}else{return"bluestone"}}GUI=function(game,stage,player,sm){this.game=game;this.player=player;this.stage=stage;this.numberHeart=10;achat=5;this.sm=sm;style={font:"40px Arial",fill:"#000000",align:"left"};resourcesStyle={font:"20px Arial",fill:"#000000",align:"left"};this.redstone=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle);this.bluestone=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle);this.greenstone=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle);this.turretsCapacity=this.game.add.text(this.game.camera.x,this.game.camera.y,"X",resourcesStyle);this.hearts=this.game.add.group();for(var i=this.numberHeart-1;i>=0;i--){h=this.hearts.create(i*35+15,34,"heart");h.scale.setTo(.3,.3)}this.hearts.setAll("fixedToCamera",true);this.redstone.fixedToCamera=true;this.redstone.cameraOffset.setTo(960,45);this.bluestone.fixedToCamera=true;this.bluestone.cameraOffset.setTo(960,85);this.greenstone.fixedToCamera=true;this.greenstone.cameraOffset.setTo(960,130);this.turretsCapacity.fixedToCamera=true;this.turretsCapacity.cameraOffset.setTo(800,45);this.turret=this.game.add.sprite(770,35,"turret");this.turret.scale.setTo(.1,.1);this.turret.fixedToCamera=true;this.stones=this.game.add.group();r=this.stones.create(900,30,"redstone");r.scale.setTo(.5,.5);b=this.stones.create(900,70,"bluestone");b.scale.setTo(.5,.5);g=this.stones.create(900,120,"greenstone");g.scale.setTo(.5,.5);this.stones.setAll("fixedToCamera",true);this.game.add.text(90,120,"R : RESET",resourcesStyle);this.game.add.text(345,120,"F : FUSION",resourcesStyle);var nbItem=4;this.positionMilieu=nbItem*90/2-3*90/2;this.game.add.text(this.positionMilieu+90+42,300,"MACHINE Ã€ FUSION",resourcesStyle);this.graphics=this.game.add.graphics(90,150);this.elementFusion=this.game.add.group();this.elementFusion.enableBody=true;var elementF=["redstone","bluestone","greenstone","player"];this.createMachine(nbItem,elementF);this.positionDrag=new Phaser.Point;this.tabFusion=[];var actionKey_R=this.game.input.keyboard.addKey(Phaser.Keyboard.R);actionKey_R.onDown.add(this.initItemFusion,this);var actionKey_F=this.game.input.keyboard.addKey(Phaser.Keyboard.F);actionKey_F.onDown.add(this.fusion,this);var x=nbItem*90+40;this.legend(x)};GUI.prototype.setDisplayStone=function(){this.redstone.text="X "+this.player.numberStoneRed;this.bluestone.text="X "+this.player.numberStoneBlue;this.greenstone.text="X "+this.player.numberStoneGreen};GUI.prototype.setDisplayHealth=function(){var difHeart=this.numberHeart-Math.ceil(this.player.health);if(difHeart===0||this.player.health>10)return;if(difHeart<0){while(difHeart!==0){var health=this.hearts.getAt(9-this.numberHeart);if(health==null)break;health.alive=true;health.visible=true;difHeart++;this.numberHeart++}}else{while(difHeart!==0){var health=this.hearts.getFirstAlive();if(health==null)break;health.alive=false;health.visible=false;difHeart--;this.numberHeart--}}};GUI.prototype.setDisplayTurrets=function(){this.turretsCapacity.text=this.player.nbrTurrets+" / "+this.player.maxTurrets};GUI.prototype.action=function(){this.setDisplayStone();this.setDisplayHealth();this.setDisplayTurrets()};GUI.prototype.displayWave=function(waveCount){waveInfos=this.game.add.text(this.game.camera.x,this.game.camera.y,"WAVE "+waveCount,style);waveInfos.fixedToCamera=true;waveInfos.cameraOffset.setTo(450,300);waveInfos.alpha=0;var tween=this.game.add.tween(waveInfos).to({alpha:1},2e3,"Linear",true,0,-1).repeat(0);tween.yoyo(true,3e3);this.sm.gong.play()};GUI.prototype.endGame=function(waveCount){this.sm.vousetesunechec.play();this.player.kill();reset=this.game.add.button(530,400,"reset-button",this.back,this,2,1,0,2);reset.scale.setTo(2,2);reset.anchor.setTo(.5,.5);reset.fixedToCamera=true;end=this.game.add.sprite(350,70,"gameover");end.fixedToCamera=true;end.alpha=0;tween=this.game.add.tween(end).to({alpha:1},1e3,"Linear",true,0,-1).repeat(0);endInfo=this.game.add.text(this.game.camera.x+100,this.game.camera.y+65,"Wave: "+waveCount,style);endInfo.anchor.set(.5)};GUI.prototype.legend=function(x){var resourcesStyleLegend={font:"18px Arial",fill:"#000000",align:"left"};this.graphics.beginFill(12303291,1);this.graphics.drawRect(x-10,-120,410,565);this.graphics.endFill();this.game.add.text(x+45+200,35,"LEGENDE",resourcesStyleLegend);var menu=this.game.add.text(x+45+42,205,"TURRET",resourcesStyleLegend);menu.angle=-90;this.graphics.lineStyle(2,15887439,1);this.graphics.moveTo(x+7,-20);this.graphics.lineTo(x+7,-90);this.graphics.lineTo(x+100,-90);this.graphics.lineStyle(2,15887439,1);this.graphics.moveTo(x+7,60);this.graphics.lineTo(x+7,130);this.graphics.lineTo(x+100,130);var menu=this.game.add.text(x+45+42,500,"PERSONNAGE",resourcesStyleLegend);menu.angle=-90;this.graphics.lineStyle(2,15887439,1);this.graphics.moveTo(x+7,220);this.graphics.lineTo(x+7,140);this.graphics.lineTo(x+100,140);this.graphics.lineStyle(2,15887439,1);this.graphics.moveTo(x+7,355);this.graphics.lineTo(x+7,435);this.graphics.lineTo(x+100,435);var distance=75;var ressourceNbStyle={font:"10px Arial",fill:"#000000",align:"left"};var tabLeg=[["redstone","bluestone","MUR"],["greenstone","redstone","CERCLE"],["bluestone","greenstone","INVINCIBLE"],["player","redstone","FORCE"],["player","bluestone","DEFENCE"],["player","greenstone","VITESSE"],["redstone","bluestone","greenstone","TURRET"]];for(var i=0;i<7;i++){var separation=0;if(i>=3){separation=10}this.game.add.text(x+90*1+85,80+separation+distance*i,"+",resourcesStyle);if(i<6){this.game.add.text(x+90*2+85,88+separation+distance*i,"=",resourcesStyle);this.game.add.text(x+90*2+85+25,88+separation+distance*i,tabLeg[i][2],resourcesStyle)}else{this.game.add.text(x+90*2+85,80+separation+distance*i,"+",resourcesStyle);this.game.add.text(x+90*3+85,88+separation+distance*i,"=",resourcesStyle);this.game.add.text(x+90*3+85+25,88+separation+distance*i,tabLeg[i][3],resourcesStyle)}if(tabLeg[i][0]=="player"){this.game.add.text(x+90+40,60+separation+distance*i,"X1",ressourceNbStyle)}else{this.game.add.text(x+90+35,65+separation+distance*i,"X"+achat,ressourceNbStyle)}this.game.add.text(x+90*2+35,65+separation+distance*i,"X"+achat,ressourceNbStyle);this.graphics.lineStyle(2,15887439,1);this.graphics.moveTo(x+90-10,-45+separation+distance*i);this.graphics.lineTo(x+90+10,-45+separation+distance*i);this.graphics.lineTo(x+90+5,-50+separation+distance*i);this.graphics.moveTo(x+90+10,-40+separation+distance*i);this.graphics.lineTo(x+90-10,-40+separation+distance*i);this.graphics.lineTo(x+90-5,-35+separation+distance*i);var imageF1=this.game.add.sprite(x+90+45,100+separation+distance*i,tabLeg[i][0]);imageF1.anchor.set(.5);imageF1.scale.setTo(.5,.5);var imageF1=this.game.add.sprite(x+90*2+45,100+separation+distance*i,tabLeg[i][1]);imageF1.anchor.set(.5);imageF1.scale.setTo(.5,.5);if(i===6){var imageF1=this.game.add.sprite(x+90*3+45,100+separation+distance*i,tabLeg[i][2]);imageF1.anchor.set(.5);imageF1.scale.setTo(.5,.5);this.graphics.moveTo(x+90*2-10,-45+separation+distance*i);this.graphics.lineTo(x+90*2+10,-45+separation+distance*i);this.graphics.lineTo(x+90*2+5,-50+separation+distance*i);this.graphics.moveTo(x+90*2+10,-40+separation+distance*i);this.graphics.lineTo(x+90*2-10,-40+separation+distance*i);this.graphics.lineTo(x+90*2-5,-35+separation+distance*i);this.game.add.text(x+90*3+35,65+separation+distance*i,"X"+achat,ressourceNbStyle)}}};GUI.prototype.createMachine=function(nbItem,elementF){this.graphics.lineStyle(5,6710886,1);this.graphics.beginFill(12303291,.7);for(var a=0;a<nbItem;a++){this.graphics.drawRect(90*a,0,90,90);var imageF=this.game.add.sprite(90*a+135,150+45,elementF[a]);imageF.anchor.set(.5);imageF.scale.setTo(.8,.8);imageF.inputEnabled=true;imageF.input.enableDrag();imageF.events.onDragStart.add(this.dragStart,this);imageF.events.onDragStop.add(this.dragStop,this);this.elementFusion.add(imageF)}this.graphics.endFill();this.graphics.lineStyle(5,6710886,1);this.graphics.beginFill(6710886,1);var topFleche=nbItem*90/2;this.graphics.moveTo(topFleche,100);this.graphics.lineTo(topFleche,130);this.graphics.lineTo(topFleche-5,130);this.graphics.lineTo(topFleche,135);this.graphics.lineTo(topFleche+5,130);this.graphics.lineTo(topFleche,130);this.graphics.endFill();this.graphics.lineStyle(5,6710886,1);this.graphics.beginFill(12303291,.7);for(var a=0;a<3;a++){this.graphics.drawRect(this.positionMilieu+90*a,180,90,90)}this.graphics.endFill()};GUI.prototype.initItemFusion=function(){for(var x in this.elementFusion.children){this.elementFusion.children[x].x=90*x+135;this.elementFusion.children[x].y=150+45;this.elementFusion.children[x].inputEnabled=true}this.tabFusion=[]};GUI.prototype.dragStart=function(sprite){this.positionDrag.x=sprite.position.x;this.positionDrag.y=sprite.position.y};GUI.prototype.dragStop=function(sprite){if(sprite.y<=240||this.tabFusion.length>=3){sprite.x=this.positionDrag.x;sprite.y=this.positionDrag.y}else{var nb=this.tabFusion.length;sprite.x=this.positionMilieu+90*nb+135;sprite.y=330+45;sprite.inputEnabled=false;this.tabFusion.push(sprite)}};GUI.prototype.fusion=function(sprite){if(this.tabFusion.length<=1){return}var tabObject=[];for(var x in this.elementFusion.children){if(!this.elementFusion.children[x].inputEnabled){tabObject[x]=true}else{tabObject[x]=false}}var works=false;if(this.tabFusion.length===3){if(tabObject[0]&&tabObject[1]&&tabObject[2]){if(this.player.numberStoneBlue>=achat&&this.player.numberStoneRed>=achat&&this.player.numberStoneGreen>=achat&&this.player.maxTurrets<30){this.player.numberStoneBlue-=achat;this.player.numberStoneRed-=achat;this.player.numberStoneGreen-=achat;this.player.maxTurrets+=5;works=true;this.sm.capaciteaugmente.play()}}}else{if(tabObject[0]&&tabObject[1]){if(this.player.numberStoneBlue>=achat&&this.player.numberStoneRed>=achat){this.player.numberStoneBlue-=achat;this.player.numberStoneRed-=achat;this.player.bonus2=true;this.player.flash.visible=true;works=true;this.sm.murdeboules.play()}}if(tabObject[0]&&tabObject[2]){if(this.player.numberStoneGreen>=achat&&this.player.numberStoneRed>=achat){this.player.numberStoneGreen-=achat;this.player.numberStoneRed-=achat;this.player.bonus1=true;works=true;this.player.flash.visible=true;this.sm.rayonbrutal.play()}}if(tabObject[1]&&tabObject[2]){if(this.player.numberStoneGreen>=achat&&this.player.numberStoneBlue>=achat){this.player.numberStoneGreen-=achat;this.player.numberStoneBlue-=achat;this.player.bonus3=true;works=true;this.player.flash.visible=true;this.sm.immunitedivine.play()}}if(tabObject[3]&&tabObject[0]){if(this.player.numberStoneRed>=achat){this.player.numberStoneRed-=achat;this.player.domage++;works=true;this.sm.forceaugmente.play()}}if(tabObject[3]&&tabObject[1]){if(this.player.numberStoneBlue>=achat){this.player.numberStoneBlue-=achat;this.player.def+=.5;works=true;this.sm.peaudebelier.play()}}if(tabObject[3]&&tabObject[2]){if(this.player.numberStoneGreen>=achat){this.player.numberStoneGreen-=achat;this.player.MAX_SPEED+=100;this.sm.vitessedepegase.play();works=true}}}if(!works){this.sm.mauvaisecombinaison.play();this.sm.error.play()}this.initItemFusion()};GUI.prototype.back=function(){this.game.sound.stopAll();this.game.state.start("menu")};Kamikaze=function(x,y,game,speed,hp,player,chance,nbItem,domage,sm){this.player=player;this.speed=speed;this.spikeSpeed=200;this.domage=domage;this.hp=hp;this.chance=chance;this.nbrR=Math.floor(nbItem*Math.random())+1;this.exploded=false;this.angleMax=.5;this.distance=100;this.sm=sm;this.spikes=game.add.group();this.spikes.enableBody=true;Phaser.Sprite.call(this,game,x,y,"kamikaze");this.scale.setTo(.2,.2);game.physics.enable(this,Phaser.Physics.ARCADE);this.body.collideWorldBounds=false;this.body.checkCollision.up=false;this.body.checkCollision.down=false;this.body.checkCollision.left=false;this.body.checkCollision.right=false;this.exploding=false;this.anchor.set(.5);this.timerDomage=0};Kamikaze.prototype=Object.create(Phaser.Sprite.prototype);Kamikaze.prototype.action=function(time,powerups,stage){this.game.physics.arcade.overlap(this.player.turrets,this.spikes,this.spikeCollision,null,this);this.game.physics.arcade.overlap(this.player,this.spikes,this.spikeCollision,null,this);if(!this.alive)return;if(Phaser.Point.distance(this.position,this.player.position)<this.distance&&!this.exploding){this.body.velocity.x=0;this.body.velocity.y=0;this.game.time.events.add(Phaser.Timer.SECOND*1,this.explode,this);this.exploding=true}else if(!this.exploding){this.homing()}if(this.hp<=0){this.dropResource(powerups);this.destroy();return}if(this.exploded){this.kill();this.game.time.events.add(Phaser.Timer.SECOND*4,this.destroy,this)}};Kamikaze.prototype.dropResource=function(){if(Math.random()<this.chance){powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),true,this.nbrR))}if(Math.random()<.05){powerups.add(new Powerups(this.x,this.y,this.game,"heart",true,1))}};Kamikaze.prototype.hurt=function(dmg,behavior){if(!(behavior===3)){this.sm.enemyhurt.play()}this.hp-=dmg};Kamikaze.prototype.explode=function(){var angle=0;if(this.alive){this.sm.turretneutretir.play();for(var i=0;i<10;i++){spike=this.spikes.create(this.body.x,this.body.y,"bullet");spike.body.velocity.x=Math.cos(angle)*this.spikeSpeed;spike.body.velocity.y=Math.sin(angle)*this.spikeSpeed;spike.lifespan=4e3;angle+=2*Math.PI/10}this.exploded=true}};Kamikaze.prototype.homing=function(){var angleTarget;angleTarget=this.game.math.angleBetween(this.x,this.y,this.player.x,this.player.y);var rotation=(this.angle-90)*(Math.PI/180);if(rotation!==angleTarget){var differenceAngle=angleTarget-rotation;if(differenceAngle>Math.PI){differenceAngle-=Math.PI*2}else if(differenceAngle<-Math.PI){differenceAngle+=Math.PI*2}if(Math.abs(differenceAngle)<this.angleMax){rotation=angleTarget}else if(differenceAngle>0){rotation+=this.angleMax}else{rotation-=this.angleMax}}this.body.velocity.x=Math.cos(rotation)*this.speed;this.body.velocity.y=Math.sin(rotation)*this.speed;this.rotation=rotation;this.angle+=90};Kamikaze.prototype.spikeCollision=function(target,spike){target.hurt(this.domage*100);spike.destroy()};Kamikaze.prototype.slowDown=function(){if(!this.sm.ennemibouffecore.isPlaying){this.sm.ennemibouffecore.play()}this.body.velocity.x=-10;this.body.gravity.y=0;this.body.velocity.y=0};MasterTurret=function(x,y,game,domage,nbrMissile,cooldown,hp,rayon,nbResMax,sm){Phaser.Sprite.call(this,game,x,y,"boss");this.animations.add("left",[0,1,2],5,true);this.animations.add("notMove",[0],5,true);this.anchor.x=.5;this.anchor.y=.1;scalex=.3;this.scale.x=scalex;this.scale.y=.3;this.game.physics.enable(this,Phaser.Physics.ARCADE);this.body.gravity.y=500;this.body.collideWorldBounds=true;this.time=0;this.distance=1e3;this.sm=sm;this.hp=hp;this.nbrMissile=nbrMissile;this.cooldown=cooldown;this.domage=domage;this.rayon=rayon;this.cooldownTemp=0;this.turretList=[];this.changeTurretList=[];this.nbResMax=nbResMax;this.bullets=this.game.add.group();this.bullets.enableBody=true;this.spikes=game.add.group();this.spikes.enableBody=true;this.eventFire;this.nbrExplose=3;this.currentNbrExplose=1;this.tween;this.direction;this.timePause=0;this.moveLeft()};MasterTurret.prototype=Object.create(Phaser.Sprite.prototype);MasterTurret.prototype.moveRigth=function(){this.tween=this.game.add.tween(this).to({x:this.x+800},15e3);this.tween.onComplete.add(this.moveLeft,this);this.tween.start(3e3);this.animations.play("left");this.scale.x=-scalex;this.direction="right"};MasterTurret.prototype.moveLeft=function(){this.tween=this.game.add.tween(this).to({x:this.x-800},15e3);this.tween.onComplete.add(this.moveRigth,this);this.tween.start(3e3);this.animations.play("left");this.scale.x=scalex;this.direction="left"};MasterTurret.prototype.reviveJungle=function(hp,domage,nbr,cooldown,nrRessource){this.revive();this.hp=hp;this.nbrMissile=nbr;this.cooldown=cooldown;this.domage=domage;this.nbResMax=nrRessource;this.cooldownTemp=0;this.x=2100;this.y=50;this.bullets=this.game.add.group();this.bullets.enableBody=true;this.eventFire;this.direction;this.timePause=0;this.moveLeft()};MasterTurret.prototype.action=function(a,b,stage,player){var distancePlayerJungle=Phaser.Point.distance(this.position,player.position);if(distancePlayerJungle<this.distance&&!this.sm.drum1.isPlaying&&player.y<570&&this.alive){this.sm.drum1.play("",0,1,true)}else if(distancePlayerJungle>this.distance||player.y>=570||!this.alive){this.sm.drum1.stop()}if(this.alive===false){return}if(this.hp<=0){this.createResource();stage.timeJungleSpwan=this.game.time.now+1e5;for(var x in this.bullets.children){this.bullets.children[x].graphic.destroy()}this.bullets.destroy();this.kill();this.tween.stop();this.game.time.events.remove(this.eventFire);return}this.time+=this.game.time.elapsed;var cooldown=this.cooldownTemp;this.turretList=[];this.changeTurretList=[];for(var x in this.bullets.children){if(this.bullets.children[x].behavior===3){this.turretList.push(this.bullets.children[x].target)}if(this.bullets.children[x].needChangeTarget){this.changeTurretList.push(this.bullets.children[x])}}for(var x in this.changeTurretList){if(this.turretList.indexOf(player)===-1){this.changeTurretList[x].target=player;this.changeTurretList[x].needChangeTarget=false;this.turretList.push(player);continue}for(var y in player.turrets.children){if(this.turretList.indexOf(player.turrets.children[y])!==-1){continue}var dis=Phaser.Point.distance(this.position,player.turrets.children[y].position);if(dis<this.rayon){this.changeTurretList[x].target=player.turrets.children[y];this.changeTurretList[x].needChangeTarget=false;this.turretList.push(player.turrets.children[y])}}}if(cooldown<=this.time){this.shootMissile(player,cooldown)}for(var x in this.bullets.children){this.bullets.children[x].actionMissile()}this.game.physics.arcade.overlap(player,this.bullets,this.collisionMissile,null,this);this.game.physics.arcade.overlap(player,this.spikes,this.spikeCollision,null,this);if(this.tween.isPaused&&this.timePause<=this.game.time.now){this.animations.play("left");this.tween.resume();this.timePause=0}};MasterTurret.prototype.createResource=function(){powerups.add(new Powerups(this.x,this.y,this.game,"redstone",true,Math.floor(this.nbResMax*Math.random())+1));powerups.add(new Powerups(this.x,this.y,this.game,"greenstone",true,Math.floor(this.nbResMax*Math.random())+1));powerups.add(new Powerups(this.x,this.y,this.game,"bluestone",true,Math.floor(this.nbResMax*Math.random())+1))};MasterTurret.prototype.collisionMissile=function(cible,bullet){if(bullet.behavior===2||bullet.behavior===4){if(bullet.timeDomageEffet<this.game.time.now){cible.hurt(this.domage*25);bullet.timeDomageEffet=this.game.time.now+1e3}}else{cible.hurt(this.domage*100);bullet.needDestroy=true}};MasterTurret.prototype.spikeCollision=function(target,spike){target.hurt(this.domage*100);spike.destroy()};MasterTurret.prototype.shootMissile=function(player,cooldown){var maxEnemy=this.nbrMissile;var isShoot=false;var dis=Phaser.Point.distance(this.position,player.position);if(dis<this.rayon){this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,player,this.rayon,1,this.domage,4e3));this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,player,this.rayon,3,this.domage,4e3));maxEnemy-=1;if(!isShoot){this.currentNbrExplose=1;this.explode(0)}isShoot=true}for(var x in player.turrets.children){if(maxEnemy<=0){break}dis=Phaser.Point.distance(this.position,player.turrets.children[x].position);if(dis<this.rayon){this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,player.turrets.children[x],this.rayon,1,this.domage,5e3));this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,player.turrets.children[x],this.rayon,3,this.domage,5e3));maxEnemy-=1;if(!isShoot){this.currentNbrExplose=1;this.explode(0)}isShoot=true}}if(isShoot){this.tween.pause();this.timePause=this.game.time.now+4e3;this.animations.play("notMove");this.time=0;this.cooldownTemp=this.cooldown}};MasterTurret.prototype.explode=function(angleDebut){var angle=angleDebut*(Math.PI/180);if(this.alive){for(var i=0;i<10;i++){spike=this.spikes.create(this.x,this.y,"bullet");spike.body.velocity.x=Math.cos(angle)*200;spike.body.velocity.y=Math.sin(angle)*200;spike.lifespan=4e3;angle+=2*Math.PI/10}this.sm.turretneutretir.play()}if(this.currentNbrExplose>=this.nbrExplose)return;this.currentNbrExplose++;if(angleDebut===0){this.eventFire=this.game.time.events.add(1e3,this.explode,this,18)}else{this.eventFire=this.game.time.events.add(1e3,this.explode,this,0)}};MasterTurret.prototype.hurt=function(dmg,behavior){if(!(behavior===3)){this.sm.enemyhurt.play()}this.hp-=dmg};MyGame.Menu=function(game){this.music=null;this.playButton=null};MyGame.Menu.prototype={create:function(){this.music=this.add.audio("maintheme");this.music.play("",0,1,true);click=this.add.audio("clic");choice=this.add.audio("playertire");this.playMusic=true;this.world.setBounds(0,0,1024,600);this.stage.backgroundColor="#000000";this.titleSprite=this.add.sprite(this.world.centerX,this.world.centerY-170,"title");this.titleSprite.anchor.setTo(.5,.5);this.titleSprite.scale.setTo(1.5,2);this.playButton=this.add.button(this.world.centerX,this.world.centerY,"play-button",this.startGame,this,2,1,0,2);this.playButton.anchor.setTo(.5,.5);this.playButton.scale.setTo(4,2);this.playButton.onInputOver.add(over,this);this.playButton.onInputOut.add(out,this);this.optionsButton=this.add.button(this.world.centerX,this.world.centerY+110,"options-button",this.showOptions,this,2,1,0,2);this.optionsButton.scale.setTo(4,2);this.optionsButton.anchor.setTo(.5,.5);this.optionsButton.onInputOver.add(over,this);this.optionsButton.onInputOut.add(out,this);this.controlsButton=this.add.button(this.world.centerX,this.world.centerY+220,"controls-button",this.showControls,this,2,1,0,2);this.controlsButton.scale.setTo(4,2);this.controlsButton.anchor.setTo(.5,.5);this.controlsButton.onInputOver.add(over,this);this.controlsButton.onInputOut.add(out,this);this.backButton=this.add.button(1600,this.world.centerY+250,"back-button",this.back,this,2,1,0,2);this.backButton.scale.setTo(4,2);this.backButton.anchor.setTo(.5,.5);this.backButton.onInputOver.add(over,this);this.backButton.onInputOut.add(out,this);this.optionsList=this.add.sprite(1e3,0,"options");this.optionFullScreen=this.add.button(1600,this.world.centerY-93,"cursor",this.fullscreen,this,2,1,0,2);this.optionFullScreen.scale.setTo(.5,.5);this.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT;this.optionMusic=this.add.button(1600,this.world.centerY-13,"cursor",this.noMusic,this,2,1,0,2);this.optionMusic.scale.setTo(.5,.5);this.optionSound=this.add.button(1600,this.world.centerY+63,"cursor",this.mute,this,2,1,0,2);this.optionSound.scale.setTo(.5,.5);this.controlsList=this.add.sprite(1e3,0,"controls")},update:function(){},startGame:function(pointer){this.music.stop();this.state.start("game")},showOptions:function(pointer){choice.play();this.removeTitle();this.add.tween(this.optionsList).to({x:0},500,"Linear",true);this.add.tween(this.backButton).to({x:this.world.centerX},500,"Linear",true);this.add.tween(this.optionFullScreen).to({x:this.world.centerX+160},500,"Linear",true);this.add.tween(this.optionMusic).to({x:this.world.centerX+160},500,"Linear",true);this.add.tween(this.optionSound).to({x:this.world.centerX+160},500,"Linear",true)},back:function(pointer){choice.play();this.add.tween(this.titleSprite).to({x:500},500,"Linear",true);this.add.tween(this.playButton).to({x:500},500,"Linear",true);this.add.tween(this.optionsButton).to({x:500},500,"Linear",true);this.add.tween(this.controlsButton).to({x:500},500,"Linear",true);this.add.tween(this.optionsList).to({x:1e3},500,"Linear",true);this.add.tween(this.backButton).to({x:1600},500,"Linear",true);this.add.tween(this.optionFullScreen).to({x:1600},500,"Linear",true);this.add.tween(this.optionMusic).to({x:1600},500,"Linear",true);this.add.tween(this.optionSound).to({x:1600},500,"Linear",true);this.add.tween(this.controlsList).to({x:1e3},500,"Linear",true)},showControls:function(pointer){choice.play();this.removeTitle();this.add.tween(this.controlsList).to({x:0},500,"Linear",true);this.add.tween(this.backButton).to({x:this.world.centerX},500,"Linear",true)},removeTitle:function(){this.add.tween(this.titleSprite).to({x:-500},500,"Linear",true);this.add.tween(this.playButton).to({x:-500},500,"Linear",true);this.add.tween(this.optionsButton).to({x:-500},500,"Linear",true);this.add.tween(this.controlsButton).to({x:-500},500,"Linear",true)},fullscreen:function(pointer){choice.play();if(this.scale.isFullScreen){this.scale.stopFullScreen()}else{this.scale.startFullScreen(false)}},mute:function(pointer){choice.play();if(this.sound.mute){this.sound.mute=false}else{this.sound.mute=true}},noMusic:function(pointer){choice.play();if(this.music.mute){this.music.mute=false;this.playMusic=true}else{this.music.mute=true;this.playMusic=false}}};function over(button){click.play();this.tween=this.add.tween(button.scale).to({x:4.5,y:2.5},300,"Linear",true)}function out(button){this.tweens=this.add.tween(button.scale).to({x:4,y:2},300,"Linear",true)}Minion=function(x,y,game,speed,hp,type,chanceDrop,nbDrop,domage,sm){this.speed=speed;this.hp=hp;this.domage=domage;this.chance=chanceDrop;this.nbrR=Math.floor(nbDrop*Math.random())+1;this.type=type;this.sm=sm;if(type===1){Phaser.Sprite.call(this,game,x,y,"zombie");this.animations.add("left",[0,1,0,2],4,true);this.animations.play("left");this.anchor.set(.5);this.scale.setTo(.1,.1)}else if(type===2){this.sm.warcry.play();Phaser.Sprite.call(this,game,x,y,"birds");this.animations.add("left",[0,1,2,3],5,true);this.animations.play("left");this.anchor.set(.5);this.scale.setTo(.15,.15)}else{Phaser.Sprite.call(this,game,x,y,"fatass");this.animations.add("left",[0,1,0,2],5,true);this.animations.play("left");this.anchor.set(.5);this.scale.setTo(.55,.55)}game.physics.enable(this,Phaser.Physics.ARCADE);this.body.velocity.x=-speed;if(type!==2){this.body.gravity.y=500}this.body.collideWorldBounds=true;this.timerDomage=0};Minion.prototype=Object.create(Phaser.Sprite.prototype);Minion.prototype.action=function(time,powerups,stage){if(this.hp<=0){this.createResource(powerups);this.sm.drum2.stop();this.destroy()}if(this.type===3&&!drum2.isPlaying){this.sm.drum2.play("",0,1,true)}};Minion.prototype.createResource=function(){if(Math.random()<this.chance){powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),true,this.nbrR))}if(Math.random()<.05){powerups.add(new Powerups(this.x,this.y,this.game,"heart",true,1))}};Minion.prototype.hurt=function(dmg,behavior){if(!(behavior===3)){this.sm.enemyhurt.play()}this.hp-=dmg};Enemy.prototype.displayHP=function(){this.text.setText(this.hp);this.text.x=this.body.x;this.text.y=this.body.y-30};Minion.prototype.slowDown=function(){if(!this.sm.ennemibouffecore.isPlaying){this.sm.ennemibouffecore.play()}this.body.velocity.x=-10;this.body.gravity.y=0;this.body.velocity.y=0};Bullet=function(sm,x,y,game,target,rayon,kind,domage,timeLive,pointDestination,facing){this.speed=300;this.angleMax=.5;this.behavior=kind;this.domage=domage;this.timeLive=timeLive;this.rayon=rayon;this.timeDomageEffet=game.time.now;this.nbScale=.1;this.facing=facing;this.timeLaser=0;this.sm=sm;this.lasers=game.add.audio("laser");homingmissile=game.add.audio("homingmissile");this.tween;this.time=0;this.needDestroy=false;this.needChangeTarget=false;this.target=target;this.pointDestination=pointDestination;this.stop=false;this.graphic=game.add.graphics(0,0);if(kind===2){var music=this.sm.boomerang.play("boomerangSec");music.volume=3;Phaser.Sprite.call(this,game,x,y,"boomerang")}else if(kind===4){this.circle(game,x,y)}else if(kind===1){Phaser.Sprite.call(this,game,x,y,"missile");this.scale.setTo(.15,.15);this.sm.turretneutretir.play();this.trackSound=homingmissile.play()}else{Phaser.Sprite.call(this,game,x,y,"bullet");this.scale.setTo(.6,.6)}this.anchor.setTo(.5,.5);if(kind===3){this.trackLaser=this.lasers.play();this.kill()}};Bullet.prototype=Object.create(Phaser.Sprite.prototype);Bullet.prototype.actionMissile=function(){this.time+=this.game.time.elapsed;this.graphic.clear();this.graphic.position=new Phaser.Point;if(this.time>=this.timeLive||this.needDestroy){if(this.behavior===1){this.trackSound.destroy()}else if(this.behavior===3){this.trackLaser.destroy()}this.destroy();return}switch(this.behavior){case-1:this.simpleFireTurret();break;case 0:this.simpleFire();break;case 1:case 5:this.homing();break;case 2:this.boomerang();break;case 3:this.laser();break;case 4:this.ajuster();break}};Bullet.prototype.simpleFireTurret=function(){if(this.stop){return}else{this.sm.turretneutretir.play();var angleTarget=this.game.math.angleBetween(this.x,this.y,this.target.x,this.target.y);var x=Math.cos(angleTarget)*this.rayon+this.x;var y=Math.sin(angleTarget)*this.rayon+this.y;this.timeLive=1e3;this.tween=this.game.add.tween(this).to({x:x,y:y},this.timeLive);this.tween.start();this.tween.onComplete.removeAll();this.stop=true}};Bullet.prototype.simpleFire=function(){if(this.stop){return}this.sm.playertire.play();var vitesse=600;if(this.facing==="left"){this.body.velocity.x=-vitesse}else if(this.facing==="right"){this.body.velocity.x=vitesse}else if(this.facing==="up"){this.body.velocity.y=-vitesse}else if(this.facing==="down"){this.body.velocity.y=vitesse}this.stop=true};Bullet.prototype.homing=function(){var angleTarget;if(this.behavior===1){angleTarget=this.game.math.angleBetween(this.x,this.y,this.target.x,this.target.y)}else{angleTarget=this.game.math.angleBetween(this.x,this.y,this.pointDestination.x,this.pointDestination.y)}if(this.rotation!==angleTarget){var differenceAngle=angleTarget-this.rotation;if(differenceAngle>Math.PI){differenceAngle-=Math.PI*2}else if(differenceAngle<-Math.PI){differenceAngle+=Math.PI*2}if(Math.abs(differenceAngle)<this.angleMax){this.rotation=angleTarget}else if(differenceAngle>0){this.rotation+=this.angleMax}else{this.rotation-=this.angleMax}}this.body.velocity.x=Math.cos(this.rotation)*this.speed;this.body.velocity.y=Math.sin(this.rotation)*this.speed};Bullet.prototype.boomerang=function(){if(this.stop){this.rotation+=.2;return}this.timeLive=3e3;var angleTarget=this.game.math.angleBetween(this.x,this.y,this.target.x,this.target.y);var x=Math.cos(angleTarget)*this.rayon+this.x;var y=Math.sin(angleTarget)*this.rayon+this.y;this.tween=this.game.add.tween(this).to({x:x,y:y},this.timeLive/2);this.tween.yoyo(true);this.tween.start();this.tween.onComplete.removeAll();this.stop=true};Bullet.prototype.laser=function(){this.graphic.lineStyle(5,16711680,1);var dis=Phaser.Point.distance(this.position,this.target.position);if(dis>=this.rayon||!this.target.alive){this.needChangeTarget=true;this.trackLaser.stop();return}if(!this.trackLaser.isPlaying){this.trackLaser.play()}this.graphic.moveTo(this.x,this.y);this.graphic.lineTo(this.target.x,this.target.y);if(this.timeLaser<this.game.time.now){this.target.hurt(this.domage*5,this.behavior);this.timeLaser=this.game.time.now+100}};Bullet.prototype.circle=function(game,x,y){this.graphic.beginFill(8917265,.15);this.graphic.drawCircle(x,y,this.rayon);this.graphic.endFill();Phaser.Sprite.call(this,game,x,y,this.graphic.generateTexture());this.scale.setTo(.1,.1)};Bullet.prototype.ajuster=function(){if(this.stop){return}this.tween=this.game.add.tween(this.scale).to({x:1,y:1},this.timeLive/2);this.tween.yoyo(true);this.tween.start();this.tween.onComplete.removeAll();this.stop=true};Player=function(x,y,game,sm){this.MAX_SPEED=300;this.sm=sm;this.maxspeed=this.MAX_SPEED;this.friction=20;this.numberStoneBlue=0;this.numberStoneRed=0;this.numberStoneGreen=0;this.health=5;this.shotTime=0;this.isRight=true;this.timerDomage=0;this.domage=1;this.def=1;Phaser.Sprite.call(this,game,x,y,"player");this.game.physics.enable(this,Phaser.Physics.ARCADE);this.body.gravity.y=600;this.body.collideWorldBounds=true;this.body.checkCollision.up=false;this.animations.add("idleRight",[0,1,2],5,true);this.animations.add("idleLeft",[9,10,11],5,true);this.animations.add("right",[3,4,5],5,true);this.animations.add("left",[6,7,8],5,true);this.anchor.set(.5);this.playerFacing="right";this.animations.play("idleRight");this.actionKey_shift=this.game.input.keyboard.addKey(Phaser.Keyboard.SHIFT);this.actionKey_T=this.game.input.keyboard.addKey(Phaser.Keyboard.T);this.actionKey_T.onDown.add(this.creationTurret,this);this.actionKey_Q=this.game.input.keyboard.addKey(Phaser.Keyboard.Q);this.actionKey_W=this.game.input.keyboard.addKey(Phaser.Keyboard.W);this.actionKey_R=this.game.input.keyboard.addKey(Phaser.Keyboard.R);this.actionKey_E=this.game.input.keyboard.addKey(Phaser.Keyboard.E);this.actionKey_Z=this.game.input.keyboard.addKey(Phaser.Keyboard.Z);this.cursors=this.game.input.keyboard.createCursorKeys();this.actionKey_A=this.game.input.keyboard.addKey(Phaser.Keyboard.A);this.maxTurrets=5;this.nbrTurrets=0;this.bonus1=false;this.bonus2=false;this.bonus3=false};Player.prototype=Object.create(Phaser.Sprite.prototype);Player.prototype.action=function(platforms,enemy,powerups){this.body.acceleration.y=0;for(var x in this.bullets.children){this.bullets.children[x].actionMissile()}this.game.physics.arcade.collide(this,platforms);this.game.physics.arcade.overlap(player,powerups,this.collisionPlayerPowerUp,null,this);this.game.physics.arcade.overlap(player,this.turrets,this.removeTurret,null,this);this.game.physics.arcade.overlap(this.turrets,powerups,this.upGradeTurret,null,this);this.game.physics.arcade.overlap(player,enemy,this.hurtPlayer,null,this);this.game.physics.arcade.overlap(this.turrets,enemy,this.destroyTurret,null,this);this.game.physics.arcade.overlap(this.bullets,enemy,this.hurtTarget,null,this);if(this.actionKey_A.isDown){this.fire()}else{this.move()}this.manageSpeed();this.launchResource(powerups);for(var x in this.turrets.children){this.turrets.children[x].actionTurret(enemy,powerups,this)}if(this.game.time.now>player.timerDomage){this.tint=16777215}if(this.y>1120){this.y=1e3}if(this.flash.visible===true){this.flash.x=this.x;this.flash.y=this.y-74;this.flash.angle+=10}};Player.prototype.fire=function(powerups){this.body.velocity.x=0;if(this.game.time.now>this.shotTime){if(this.cursors.right.isDown){this.shotTime=this.game.time.now+400;this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"right"))}else if(this.cursors.left.isDown){this.shotTime=this.game.time.now+400;this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"left"))}else if(this.cursors.up.isDown){this.shotTime=this.game.time.now+400;this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"up"))}else if(this.cursors.down.isDown){this.shotTime=this.game.time.now+400;this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,null,null,0,this.domage,500,null,"down"))}}};Player.prototype.launchResource=function(powerups){if(this.game.time.now>this.shotTime){if(this.x>this.game.world.width-100||this.x<150)return;var nature=null;if(this.actionKey_Q.isDown&&this.numberStoneRed>0){nature="redstone";this.numberStoneRed--}else if(this.actionKey_W.isDown&&this.numberStoneBlue>0){nature="bluestone";this.numberStoneBlue--}else if(this.actionKey_E.isDown&&this.numberStoneGreen>0){nature="greenstone";this.numberStoneGreen--}if(nature==null)return;this.shotTime=this.game.time.now+400;var velocite=0;if(this.isRight){velocite=200}else{velocite=-200}var stone=new Powerups(this.x,this.y,this.game,nature,false,1);powerups.add(stone);stone.body.velocity.x=velocite;stone.body.gravity.y=100}};Player.prototype.move=function(){if(this.cursors.left.isDown){this.isRight=false;this.body.velocity.x-=50;if(this.playerFacing!=="left"){this.animations.play("left");this.playerFacing="left"}}else if(this.cursors.right.isDown){this.isRight=true;this.body.velocity.x+=50;if(this.playerFacing!=="right"){this.animations.play("right");this.playerFacing="right"}}else{if(this.playerFacing!=="idle"){this.animations.stop();if(this.playerFacing==="left"){this.animations.play("idleLeft")}else{this.animations.play("idleRight")}this.playerFacing="idle"}}if(this.cursors.up.isDown&&this.body.touching.down){this.body.velocity.y=-400;this.sm.playerjump.play()}if(!this.body.touching.down){if(this.playerFacing==="left")this.frame=12;else if(this.playerFacing==="idle")this.frame=13;else if(this.playerFacing==="right")this.frame=14}if(!this.body.touching.down&&this.cursors.down.isDown){this.body.acceleration.y=2e3}if(this.body.touching.down&&this.cursors.down.isDown){if(this.actionKey_shift.isDown&&this.body.y<1e3){this.body.checkCollision.down=false}}if(this.actionKey_shift.isUp||this.body.y>1e3){this.body.checkCollision.down=true}};Player.prototype.creationTurret=function(){if(this.nbrTurrets<this.maxTurrets){this.flash.visible=false;this.sm.construction.play();this.turrets.add(new Turret(this.x+30,this.y-50,this.game,this.bonus1,this.bonus2,this.bonus3,this.sm));this.bonus1=this.bonus2=this.bonus3=false;this.nbrTurrets++}};Player.prototype.manageSpeed=function(){if(this.actionKey_shift.isDown){this.maxspeed=this.MAX_SPEED*1.5}else{this.maxspeed=this.MAX_SPEED}if(this.body.velocity.x>this.maxspeed){this.body.velocity.x=this.maxspeed}if(this.body.velocity.x<-this.maxspeed){this.body.velocity.x=-this.maxspeed}if(this.body.velocity.x>0){this.body.velocity.x-=this.friction;if(this.body.velocity.x<0){this.body.velocity.x=0}}if(this.body.velocity.x<0){this.body.velocity.x+=this.friction;if(this.body.velocity.x>0){this.body.velocity.x=0}}};Player.prototype.collisionPlayerPowerUp=function(player,powerups){if(!powerups.collidePlayer||!powerups.alive)return;this.sm.pickup.play();switch(powerups.key){case"redstone":player.numberStoneRed+=powerups.number;break;case"greenstone":player.numberStoneGreen+=powerups.number;break;case"bluestone":player.numberStoneBlue+=powerups.number;break;case"heart":if(player.health<10)player.health++;break;case"turret":player.nbrTurrets--;break}powerups.alive=false};Player.prototype.upGradeTurret=function(turret,powerups){if(!powerups.alive)return;switch(powerups.key){case"redstone":if(turret.kind===3){if(turret.rayon<1e3){turret.rayon=turret.rayon+25}}else{turret.kind=3;turret.tint=16711680}break;case"greenstone":if(turret.kind===2){if(turret.cooldown>1e3){turret.cooldown=turret.cooldown-125}}else{turret.kind=2;turret.tint=2672384}break;case"bluestone":if(turret.kind===1){if(turret.numberEnemyShoot<10){turret.numberEnemyShoot+=.225}}else{turret.kind=1;turret.tint=44769}break}if(powerups.key!=="heart"&&powerups.key!=="turret"){turret.domage=turret.domage+.5;powerups.alive=false;this.sm.turretfeed.play()}};Player.prototype.hurt=function(dmg){this.health-=dmg/100/this.def;this.sm.playerhurt.play()};Player.prototype.hurtPlayer=function(player,enemies){if(this.game.time.now>player.timerDomage){player.health-=enemies.domage/this.def;player.timerDomage=this.game.time.now+1e3;this.tint=16711680;this.sm.playerhurt.play()}};Player.prototype.hurtTarget=function(bullet,enemy){if(bullet.needDestroy)return;enemy.hurt(this.domage*50);bullet.needDestroy=true};Player.prototype.destroyTurret=function(turret,enemies){if(this.game.time.now>enemies.timerDomage){turret.hurt(enemies.domage*20,enemies)}};Player.prototype.cheat=function(){this.numberStoneBlue+=10;this.numberStoneRed+=10;this.numberStoneGreen+=10;this.maxTurrets+=10};Player.prototype.removeTurret=function(player,turret){if(this.actionKey_R.isDown){turret.hp=0}};Powerups=function(x,y,game,name,isCollidePlayer,number){Phaser.Sprite.call(this,game,x,y,name);this.anchor.x=.5;this.game.physics.enable(this,Phaser.Physics.ARCADE);this.body.gravity.y=500;this.body.collideWorldBounds=true;this.scale.setTo(.35,.35);if(name==="turret"){this.scale.setTo(.15,.15)}this.collidePlayer=isCollidePlayer;this.number=number};Powerups.prototype=Object.create(Phaser.Sprite.prototype);Powerups.prototype.action=function(){if(!this.alive){this.destroy();return}var velocityX=this.body.velocity.x;if(velocityX>0){if(this.body.touching.down){var ralentissement=10;if(velocityX<=10){ralentissement=velocityX;this.collidePlayer=true}this.body.velocity.x-=ralentissement}}if(velocityX<0){if(this.body.touching.down){var ralentissement=-10;if(velocityX>=-10){ralentissement=velocityX;this.collidePlayer=true}this.body.velocity.x-=ralentissement}}if(this.x>this.game.world.width-50||this.x<50){this.body.velocity.x=0;this.collidePlayer=true}};MyGame.Preloader=function(game){this.loadingBar=null;this.ready=false};MyGame.Preloader.prototype={preload:function(){this.loadingBar=this.add.sprite(this.world.centerX,this.world.centerY,"loading");this.loadingBar.anchor.setTo(.5,.5);this.load.setPreloadSprite(this.loadingBar,0);this.load.image("title","assets/title.png");this.load.image("play-button","assets/play-button.png");this.load.image("options-button","assets/options-button.png");this.load.image("controls-button","assets/controls-button.png");this.load.image("cursor","assets/cursor.png");this.load.image("options","assets/options.png");this.load.image("back-button","assets/back-button.png");this.load.image("controls","assets/controls.png");this.load.image("reset-button","assets/reset-button.png");this.load.image("fond_degrader","assets/fond_degrader.png");this.load.image("skin","assets/skin.png");this.load.image("platform","assets/platform.png");this.load.image("platform2","assets/platform2.png");this.load.image("grass","assets/grass.png");this.load.image("ground","assets/ground.png");this.load.image("jungleground","assets/jungleground.png");this.load.image("fond1","assets/fond1.png");this.load.image("turret","assets/turret.png");this.load.image("bullet","assets/bullet.png");this.load.image("boomerang","assets/boomerang.png");this.load.image("missile","assets/missile.png");this.load.spritesheet("player","assets/player.png",50,100);this.load.image("flash","assets/flash.png");this.load.spritesheet("enemy","assets/ennemies.png",50,100);this.load.spritesheet("birds","assets/birds.png",600,300);this.load.spritesheet("zombie","assets/zombie.png",500,1e3);this.load.spritesheet("puker","assets/puker.png",500,1e3);this.load.spritesheet("fatass","assets/fatass.png",500,1e3);this.load.image("kamikaze","assets/kamikaze.png");this.load.spritesheet("boss","assets/boss.png",500,1e3);this.add.audio("maintheme");this.load.audio("maintheme","assets/audio/themesong.mp3");this.load.audio("level","assets/audio/level1.mp3");this.load.audio("forceaugmente","assets/audio/forceaugmente.mp3");this.load.audio("clic","assets/audio/clic.mp3");this.load.audio("birds","assets/audio/birds.mp3");this.load.audio("boomerang","assets/audio/boomerang.mp3");this.load.audio("capaciteaugmente","assets/audio/capaciteaugmente.mp3");this.load.audio("construction","assets/audio/construction.mp3");this.load.audio("drum1","assets/audio/drum1.mp3");this.load.audio("drum2","assets/audio/drum2.mp3");this.load.audio("enemyhurt","assets/audio/enemyhurt.mp3");this.load.audio("ennemibouffecore","assets/audio/ennemibouffecore.mp3");this.load.audio("error","assets/audio/error.mp3");this.load.audio("fusion","assets/audio/fusion.mp3");this.load.audio("gong","assets/audio/gong.mp3");this.load.audio("homingmissile","assets/audio/homingmissile.mp3");this.load.audio("immunitedivine","assets/audio/immunitedivine.mp3");this.load.audio("laser","assets/audio/laser.mp3");this.load.audio("mauvaisecombinaison","assets/audio/mauvaisecombinaison.mp3");this.load.audio("turretneutretir","assets/audio/turretneutretir.mp3");this.load.audio("murdeboules","assets/audio/murdeboules.mp3");this.load.audio("vitessedepegase","assets/audio/vitessedepegase.mp3");this.load.audio("peaudebelier","assets/audio/peaudebelier.mp3");this.load.audio("vousetesunechec","assets/audio/vousetesunechec.mp3");this.load.audio("pickup","assets/audio/pickup.mp3");this.load.audio("playerhurt","assets/audio/playerhurt.mp3");this.load.audio("playerjump","assets/audio/playerjump.mp3");this.load.audio("playertire","assets/audio/playertire.mp3");this.load.audio("puker","assets/audio/puker.mp3");this.load.audio("rayonbrutal","assets/audio/rayonbrutal.mp3");this.load.audio("transitiondown","assets/audio/transitiondown.mp3");this.load.audio("transitionup","assets/audio/transitionup.mp3");this.load.audio("turretfeed","assets/audio/turretfeed.mp3");this.load.audio("destroyturret","assets/audio/destroyturret.mp3");this.load.image("heart","assets/heart.png");this.load.image("redstone","assets/redstone.png");this.load.image("bluestone","assets/bluestone.png");this.load.image("greenstone","assets/greenstone.png");this.load.image("gameover","assets/gameover.png");this.load.image("fond_etoile","assets/fond_etoile.png");this.load.image("wave","assets/wave.png")},create:function(){this.loadingBar.cropEnabled=true},update:function(){if(this.cache.isSoundDecoded("maintheme")&&!this.ready){this.ready=true;this.state.start("menu")}}};Puker=function(x,y,game,speed,hp,player,chanceDrop,nbDrop,domage,sm){this.game=game;this.speed=speed;this.domage=domage;this.player=player;this.hp=hp;this.chance=chanceDrop;this.nbrR=Math.floor(nbDrop*Math.random())+1;this.sm=sm;Phaser.Sprite.call(this,game,x,y,"puker");game.physics.enable(this,Phaser.Physics.ARCADE);this.body.velocity.x=-speed;this.body.gravity.y=500;this.body.collideWorldBounds=true;this.animations.add("left",[0,1,2],5,true);this.animations.play("left");this.anchor.set(.5);this.scale.setTo(.15,.15);this.timerDomage=0;this.timeRandom=Math.floor(6*Math.random()+5);this.eventFire=game.time.events.add(this.timeRandom*1e3,this.fire,this);this.nbFire=4;this.bullets=this.game.add.group();this.bullets.enableBody=true};Puker.prototype=Object.create(Phaser.Sprite.prototype);Puker.prototype.action=function(time,powerups,stage){if(this.hp<=0){this.createResource(powerups);this.game.time.events.remove(this.eventFire);this.bullets.destroy();this.destroy();return}this.game.physics.arcade.overlap(this.player,this.bullets,this.hurtPlayer,null,this);this.game.physics.arcade.overlap(this.player.turrets,this.bullets,this.hurtPlayer,null,this)};Puker.prototype.fire=function(){var missile=this.game.add.sprite(this.x,this.y,"bullet");if(this.nbFire===4){var sound=this.sm.puke.play("puker3Sec");sound.volume=6}this.bullets.add(missile);this.game.physics.enable(missile,Phaser.Physics.ARCADE);missile.body.gravity.y=200;var angle=this.game.math.angleBetween(this.x,this.y,this.player.x,this.player.y);missile.body.velocity.x=Math.cos(angle)*400;missile.body.velocity.y=Math.sin(angle)*400;if(this.nbFire>0){this.eventFire=this.game.time.events.add(100,this.fire,this);this.nbFire--}else{this.eventFire=this.game.time.events.add(this.timeRandom*1e3,this.fire,this);this.nbFire=4}};Puker.prototype.createResource=function(){if(Math.random()<this.chance){powerups.add(new Powerups(this.x,this.y,this.game,getRandomStone(),true,this.nbrR))}if(Math.random()<.05){powerups.add(new Powerups(this.x,this.y,this.game,"heart",true,1))}};Puker.prototype.hurt=function(dmg,behavior){if(!(behavior===3)){this.sm.enemyhurt.play()}this.hp-=dmg};Puker.prototype.hurtPlayer=function(cible,bullet){cible.hurt(this.domage*10);bullet.destroy()};Puker.prototype.slowDown=function(){if(!this.sm.ennemibouffecore.isPlaying){this.sm.ennemibouffecore.play()}this.body.velocity.x=-10;this.body.gravity.y=0;this.body.velocity.y=0};SoundManager=function(game){this.boomerang=game.add.audio("boomerang");this.boomerang.addMarker("boomerangSec",0,3);this.boomerang.allowMultiple=true;this.turretneutretir=game.add.audio("turretneutretir");this.turretneutretir.volume=.5;this.turretneutretir.allowMultiple=true;this.playertire=game.add.audio("playertire");this.enemyhurt=game.add.audio("enemyhurt");this.ennemibouffecore=game.add.audio("ennemibouffecore");this.ennemibouffecore.volume=4;this.warcry=game.add.audio("birds");this.warcry.volume=.3;this.puke=game.add.audio("puker");this.puke.addMarker("puker3Sec",0,3);this.puke.allowMultiple=true;this.drum1=game.add.audio("drum1");this.drum2=game.add.audio("drum2");this.forceaugmente=game.add.audio("forceaugmente");this.forceaugmente.volume=2;this.capaciteaugmente=game.add.audio("capaciteaugmente");this.capaciteaugmente.volume=2;this.vitessedepegase=game.add.audio("vitessedepegase");this.vitessedepegase.volume=2;this.rayonbrutal=game.add.audio("rayonbrutal");this.rayonbrutal.volume=2;this.peaudebelier=game.add.audio("peaudebelier");this.peaudebelier.volume=2;this.murdeboules=game.add.audio("murdeboules");this.murdeboules.volume=2;this.immunitedivine=game.add.audio("immunitedivine");this.mauvaisecombinaison=game.add.audio("mauvaisecombinaison");this.error=game.add.audio("error");this.vousetesunechec=game.add.audio("vousetesunechec");this.gong=game.add.audio("gong");this.gong.volume=.5;this.transitionup=game.add.audio("transitionup");this.transitiondown=game.add.audio("transitiondown");this.pickup=game.add.audio("pickup");this.pickup.allowMultiple=true;this.construction=game.add.audio("construction");this.construction.allowMultiple=true;this.playerhurt=game.add.audio("playerhurt");this.playerjump=game.add.audio("playerjump");this.turretfeed=game.add.audio("turretfeed");this.destroyturret=game.add.audio("destroyturret")};Stage=function(game,player,enemy,sm){this.game=game;this.player=player;this.sm=sm;this.background_image=game.add.sprite(0,0,"fond_etoile");this.background_image.alpha=0;game.add.tween(this.background_image).to({alpha:.8},25e3,Phaser.Easing.Exponential.InOut,true,0,-1,true);this.buildings=game.add.sprite(30,600,"fond1");this.buildings.alpha=.3;this.game.world.setBounds(0,0,2200,1200);this.game.camera.y=1200;this.skin=this.game.add.sprite(-200,0,"skin");this.ground;this.jungleGround;this.gameOver=false;enemiesByWave=5;expansion=2;this.waveCount=0;this.timeWave=0;this.timeEscorte=0;this.newWave=true;this.enemieToSpwan=5;this.timeJungleSpwan=0;this.domageJ=1;this.nbrMissileJ=1;this.cooldownJ=8e3;this.hpJ=500;this.royonJ=450;this.nbResMax=10;this.jungleEnemy=new MasterTurret(2100,50,this.game,this.domageJ,this.nbrMissileJ,this.cooldownJ,this.hpJ,this.royonJ,this.nbResMax,this.sm);enemy.add(this.jungleEnemy);this.nbItemBoss=0;this.IsShootBoss=false;this.eventBoss;this.IsShoot=false;this.eventKami;this.vieGeneral=100;this.maxEnemie=104};Stage.prototype.action=function(time,player,enemies,turrets,GUI,powerups){this.game.physics.arcade.collide(enemies,this.platforms);this.game.physics.arcade.collide(turrets,this.platforms);this.game.physics.arcade.collide(powerups,this.platforms);this.game.physics.arcade.overlap(enemies,this.skin,this.slowEnemy,null,this);if(player.health<=0&&this.gameOver===false){this.gameOver=true;GUI.endGame(this.waveCount)}this.moveCamera(player);this.changeBackgroundColor(time.now%5e4);if(this.timeJungleSpwan!==0&&this.timeJungleSpwan<this.game.time.now){this.createJungle(enemies);this.timeJungleSpwan=0}if(this.newWave&&this.timeWave<this.game.time.now||this.timeEscorte<this.game.time.now&&this.enemieToSpwan>0&&!this.newWave){if(this.newWave){this.waveCount++;if(this.waveCount===5){var mioDiv=document.getElementById("mio");mioDiv.innerHTML="FÃ©licitations! Entrez le code <b>"+"bluestone"+"</b> <a href='https://jobine.io/app/settings'>ici</a> pour recevoir votre badge!"}GUI.displayWave(this.waveCount);this.newWave=false}this.timeEscorte=this.game.time.now+3e3;this.createWave(enemies,GUI)}if(enemies.children.length===1&&!this.newWave&&this.enemieToSpwan<=0){if(enemiesByWave<this.maxEnemie){enemiesByWave=enemiesByWave+3}this.timeWave=this.game.time.now+15e3;if(this.waveCount===11){this.enemieToSpwan=10}else if(this.waveCount===14){this.enemieToSpwan=5}else{this.enemieToSpwan=enemiesByWave}this.newWave=true;if(this.IsShoot){this.game.time.events.remove(this.eventKami);this.IsShoot=false}if(this.IsShootBoss){this.game.time.events.remove(this.eventBoss);this.IsShootBoss=false}}};Stage.prototype.changeBackgroundColor=function(time){if(time<=25e3){var red=130-.0052*time;var green=253-.00532*time}else{var timeMod=time%25e3;var red=.0052*timeMod;var green=120+.00532*timeMod}this.game.stage.backgroundColor="#"+((1<<24)+(red<<16)+(green<<8)+255).toString(16).slice(1)};Stage.prototype.moveCamera=function(player){this.game.camera.x=player.x-512;if(player.y<570){if(this.game.camera.y>30){this.game.camera.y-=15;if(!this.sm.transitionup.isPlaying){this.sm.transitionup.play()}}}else{if(this.game.camera.y<600){this.game.camera.y+=15;if(!this.sm.transitiondown.isPlaying){this.sm.transitiondown.play()}}}};Stage.prototype.createPlatforms=function(){this.platforms=this.game.add.group();this.platforms.enableBody=true;this.ground=this.platforms.create(0,1170,"ground");this.game.physics.enable(this.skin,Phaser.Physics.ARCADE);this.jungleGround=this.platforms.create(0,600,"jungleground");var x=300;for(var j=0;j<5;j++){if(j%2===0){for(var i=0;i<4;i++){var y=1050-i*110;this.p=this.platforms.create(x,y,"platform");this.p.scale.setTo(.7,.5)}}else{for(var i=0;i<3;i++){var y=1e3-i*110;this.p=this.platforms.create(x,y,"platform");this.p.scale.setTo(.7,.5)}}x+=400}this.p=this.platforms.create(2050-1050,500,"platform");this.p.scale.setTo(.4,.5);this.p=this.platforms.create(2050-1050,400,"platform");this.p.scale.setTo(.4,.5);this.p=this.platforms.create(2050-840,400,"platform");this.p.scale.setTo(.4,.5);this.p=this.platforms.create(2050-630,400,"platform");this.p.scale.setTo(.4,.5);this.p=this.platforms.create(2050-420,400,"platform");this.p.scale.setTo(.4,.5);this.p=this.platforms.create(2050-210,400,"platform");this.p.scale.setTo(.4,.5);this.p=this.platforms.create(2050,400,"platform");this.p.scale.setTo(.4,.5);this.platforms.setAll("body.immovable",true);this.platforms.setAll("body.checkCollision.down",false);this.platforms.setAll("body.checkCollision.left",false);this.platforms.setAll("body.checkCollision.right",false);this.jungleGround.body.checkCollision.down=true};Stage.prototype.slowEnemy=function(skin,enemy){enemy.slowDown()};Stage.prototype.createJungle=function(enemy){this.nbResMax+=10;this.hpJ+=500;this.domageJ+=1;if(this.nbrMissileJ<5){this.nbrMissileJ+=1}if(this.cooldownJ>1e3){this.cooldownJ-=1e3}this.jungleEnemy.reviveJungle(this.hpJ,this.domageJ,this.nbrMissileJ,this.cooldownJ,this.nbResMax)};Stage.prototype.createZombie=function(enemies){if(this.enemieToSpwan<=0){return}var hpZ=50+this.vieGeneral*(this.waveCount-1);var speedZ=50;var chanceD=.6;var nbItem=1;var domageZ=1;enemies.add(new Minion(2e3,1100,this.game,speedZ,hpZ,1,chanceD,nbItem,domageZ,this.sm));this.enemieToSpwan--};Stage.prototype.createBirds=function(enemies){var hpB=10+this.vieGeneral*(this.waveCount-1);var chanceB=.5;var nbItemB=2;var domageB=1;var numberEnemie=3;if(this.enemieToSpwan<numberEnemie){numberEnemie=this.enemieToSpwan}for(var i=0;i<numberEnemie;i++){var speedB=Math.floor(Math.random()*21+50);enemies.add(new Minion(2e3,700+100*i,this.game,speedB,hpB,2,chanceB,nbItemB,domageB,this.sm));this.enemieToSpwan--}};Stage.prototype.createJumper=function(enemies){var numberEnemie=3;if(this.enemieToSpwan<numberEnemie){numberEnemie=this.enemieToSpwan}var hpJ=100+this.vieGeneral*(this.waveCount-1);var chanceJ=.7;var nbJ=3;var domage=1;for(var i=0;i<numberEnemie;i++){var speed=Math.floor(Math.random()*31+40);enemies.add(new Enemy(2e3,700+100*i,this.game,speed,hpJ,chanceJ,nbJ,domage,this.sm));this.enemieToSpwan--}};Stage.prototype.createPuker=function(enemies){if(this.enemieToSpwan<=0){return}var hpP=200+this.vieGeneral*(this.waveCount-1);var speedP=40;var chanceP=.7;var nbItemP=4;var domageP=2;enemies.add(new Puker(2050,1e3,this.game,speedP,hpP,this.player,chanceP,nbItemP,domageP,this.sm));this.enemieToSpwan--};Stage.prototype.createBoss=function(enemies){if(this.enemieToSpwan<=0)return;if(this.enemieToSpwan<=4){this.enemieToSpwan=0}else{this.enemieToSpwan-=5}var hpBoss=600*this.waveCount;var speedBoss=40;var chanceBoss=1;this.nbItemBoss=3;var domageBoss=3;enemies.add(new Minion(2e3,800,this.game,speedBoss,hpBoss,3,chanceBoss,this.nbItemBoss,domageBoss,this.sm));this.eventBoss=this.game.time.events.add(7e3,this.createBoss,this,enemies)};Stage.prototype.createWave=function(enemies,GUI){if(this.waveCount===3){this.createBirds(enemies);return}if(this.waveCount===7){this.createJumper(enemies);return}if(this.waveCount===12){this.createPuker(enemies);return}if(this.waveCount===15){if(!this.IsShoot&&this.enemieToSpwan>0){this.createKamikaze(enemies);this.IsShoot=true}return}if(this.waveCount===10){if(!this.IsShootBoss&&this.enemieToSpwan>0){this.enemieToSpwan=10;this.createBoss(enemies);this.IsShootBoss=true}return}this.createZombie(enemies);if(this.waveCount>=3){this.createBirds(enemies)}if(this.waveCount>=7){this.createJumper(enemies)}if(this.waveCount>=12){this.createPuker(enemies)}if(this.waveCount>=15){if(!this.IsShoot&&this.enemieToSpwan>0){this.createKamikaze(enemies);this.IsShoot=true}}if(this.waveCount>=18){if(!this.IsShootBoss&&this.enemieToSpwan>0){this.createBoss(enemies);this.IsShootBoss=true}}};Stage.prototype.createKamikaze=function(enemies){if(this.enemieToSpwan<=0)return;this.enemieToSpwan--;var hpP=100+this.vieGeneral*(this.waveCount-1);var speedP=500;var chanceP=1;var nbItemP=5;var domageP=3;enemies.add(new Kamikaze(2050,1e3,this.game,speedP,hpP,this.player,chanceP,nbItemP,domageP,this.sm));var timeRandom=Math.floor(5*Math.random()+8);this.eventKami=this.game.time.events.add(timeRandom*1e3,this.createKamikaze,this,enemies)};Turret=function(x,y,game,bonus1,bonus2,bonus3,sm){this.time=0;this.sm=sm;Phaser.Sprite.call(this,game,x,y,"turret");this.anchor.x=.5;this.scale.setTo(.25,.25);this.game.physics.enable(this,Phaser.Physics.ARCADE);this.body.gravity.y=500;this.body.collideWorldBounds=true;this.bonus1=bonus1;this.bonus2=bonus2;this.bonus3=bonus3;this.hp=400;this.bullets=this.game.add.group();this.bullets.enableBody=true;this.numberEnemyShoot=1;this.cooldown=6e3;this.domage=1;this.rayon=250;this.cooldownTemp=0;this.kind=-1;this.enemyList=[];this.changeEnemyList=[]};Turret.prototype=Object.create(Phaser.Sprite.prototype);Turret.prototype.actionTurret=function(enemies,powerup,player){if(this.hp<=0){for(var x in this.bullets.children){this.bullets.children[x].graphic.destroy()}this.bullets.destroy();this.createResource(powerups);this.sm.destroyturret.play();this.destroy();return}this.time+=this.game.time.elapsed;var cooldown=this.cooldownTemp;this.enemyList=[];this.changeEnemyList=[];for(var x in this.bullets.children){if(this.bullets.children[x].behavior===3){this.enemyList.push(this.bullets.children[x].target)}if(this.bullets.children[x].needChangeTarget){this.changeEnemyList.push(this.bullets.children[x])}}for(var x in this.changeEnemyList){for(var y in enemies.children){if(this.enemyList.indexOf(enemies.children[y])!==-1){continue}var dis=Phaser.Point.distance(this.position,enemies.children[y].position);if(dis<this.rayon){this.changeEnemyList[x].target=enemies.children[y];this.changeEnemyList[x].needChangeTarget=false;this.enemyList.push(enemies.children[y])}}}if(cooldown<=this.time){this.shootMissile(enemies,cooldown)}for(var x in this.bullets.children){this.bullets.children[x].actionMissile()}this.game.physics.arcade.overlap(this.bullets,enemies,this.collisionMissile,null,this)};Turret.prototype.createResource=function(){powerups.add(new Powerups(this.x,this.y,this.game,"turret",true))};Turret.prototype.collisionMissile=function(bullet,enemy){if(bullet.behavior===2||bullet.behavior===4){if(bullet.timeDomageEffet<this.game.time.now){enemy.hurt(this.domage*120);bullet.timeDomageEffet=this.game.time.now+500}}else{enemy.hurt(this.domage*200);bullet.needDestroy=true}};Turret.prototype.hurt=function(dmg,enemies){if(!this.bonus3){this.hp-=dmg;if(enemies!=null){enemies.timerDomage=this.game.time.now+1e3}}};Turret.prototype.shootMissile=function(enemy,cooldown){var maxEnemy=Math.floor(this.numberEnemyShoot);var isShoot=false;for(var x in enemy.children){if(enemy.children[x].y<600&&this.y>600)continue;if(!enemy.children[x].alive){continue}if(maxEnemy<=0){break}var dis=Phaser.Point.distance(this.position,enemy.children[x].position);if(dis<this.rayon){this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,enemy.children[x],this.rayon,this.kind,this.domage,4e3));maxEnemy-=1;if(!isShoot){if(this.bonus1){this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,enemy.children[x],this.rayon,4,this.domage,4e3))}if(this.bonus2){var point2=new Phaser.Point(this.x+70,this.y-75);var point3=new Phaser.Point(this.x+70,this.y);var point4=new Phaser.Point(this.x+70,this.y+75);this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,enemy.children[x],this.rayon,5,this.domage,4e3,point2));this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,enemy.children[x],this.rayon,5,this.domage,4e3,point3));this.bullets.add(new Bullet(this.sm,this.x,this.y,this.game,enemy.children[x],this.rayon,5,this.domage,4e3,point4))}}isShoot=true}}if(isShoot){this.time=0;this.cooldownTemp=this.cooldown}};